<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Or√ßamento de Curso Lato Sensu - Passo a Passo</title>
    
    <style>
        /* ==================== */
        /* VARI√ÅVEIS DE CORES (TEMA: PRPG UFG - VERDE/BRANCO) */
        /* ==================== */
        :root {
            --primary-color: #1A5228; /* Verde Escuro Profundo (Mais sofisticado que o #38761D) */
            --secondary-color: #FFFFFF;
            --text-color: #212529; /* Preto mais suave para texto */
            --heading-color: #1A5228; /* Mesmo verde prim√°rio para t√≠tulos */
            --bg-neutral: #F5F5F5; /* Fundo levemente mais claro */
            --border-color: #E0E0E0; /* Linhas mais finas e suaves */
            --alert-color: #C0392B; /* Vermelho mais s√≥brio */
            --success-color: #27AE60; /* Verde de sucesso mais vibrante */
            --highlight-bg: #EAF7ED; /* Fundo de destaque suave, pr√≥ximo ao branco */
            /* REVIS√ÉO MINIMALISTA */
            --font-primary: 'Helvetica Neue', Arial, sans-serif; /* Fonte moderna e limpa */
        }

        body {
            font-family: var(--font-primary);
            padding: 0;
            background: var(--bg-neutral);
            color: var(--text-color);
            margin: 0;
            line-height: 1.5;
            font-size: 16px;
        }

        .container {
            width: 90%;
            max-width: 960px;
            margin: 50px auto;
            padding: 40px;
            background-color: var(--secondary-color);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        /* --- T√çTULO PRINCIPAL --- */
        h1 {
            color: var(--primary-color);
            text-align: left;
            font-size: 2.4em;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            font-weight: 300;
        }

        /* --- CONTROLE DE ETAPAS --- */
        .step {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
            padding-top: 10px;
        }
        .step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .navigation-buttons .btn-avancar {
            margin-left: auto;
        }
        .navigation-buttons .btn-voltar {
            background-color: #6c757d;
        }
        .navigation-buttons .btn-voltar:hover {
            background-color: #5a6268;
        }

        /* --- T√çTULOS DE SE√á√ÉO --- */
        h2 {
            margin-top: 35px;
            color: var(--heading-color);
            font-size: 1.5em;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 15px;
            font-weight: 500;
        }
        h2:before {
            content: "‚Äî ";
            color: var(--primary-color);
            font-size: 1.1em;
        }
        
        /* --- BLOCO DE EXTRA√á√ÉO (SE√á√ÉO 1) --- */
        .extraction-block {
            background: var(--highlight-bg);
            padding: 25px;
            border-radius: 6px;
            border: 1px solid #D0EAD6;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out; /* Transi√ß√£o na altura e padding */
            margin-bottom: 20px;
            overflow: hidden; 
            max-height: 500px; /* Altura m√°xima inicial */
        }
        .extraction-block h3 {
            margin-top: 0;
        }
        /* NOVO: Classe para recolher o bloco */
        .extraction-block.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-bottom: 0;
            border: 1px solid transparent;
        }
        
        /* NOVO: Estilo para o bot√£o de toggle/visualizar */
        .toggle-btn {
            background: none;
            color: var(--primary-color);
            padding: 0;
            margin: 0;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            text-transform: none;
            letter-spacing: normal;
            display: block;
            text-align: left;
            border: none;
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 3px;
            transition: color 0.2s;
        }
        .toggle-btn:hover {
            color: var(--heading-color);
            transform: none;
        }

        textarea {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85em;
            min-height: 120px;
            resize: vertical;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 10px 20px;
            margin-top: 10px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover {
            background-color: var(--heading-color);
            transform: translateY(-1px);
        }

        /* REVIS√ÉO MINIMALISTA: Cor e padding para o resultado da an√°lise */
        #resultado {
            padding: 15px 0;
            white-space: pre-wrap;
            font-size: 0.9em;
            color: var(--text-color);
            /* Removido o border-bottom daqui, pois o bot√£o de toggle far√° essa fun√ß√£o */
            margin-bottom: 20px;
        }
        #resultado .alert {
            color: var(--alert-color);
            font-weight: bold;
        }

        /* --- RESULTADOS OR√áAMENT√ÅRIOS (SE√á√ÉO 3) --- */
        #orcamento {
            margin-top: 40px;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: #FAFAFA;
        }
        
        .orcamento-section-title {
            color: var(--primary-color);
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            font-weight: 500;
        }
        
        .orcamento-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
            font-size: 0.95em;
        }
        
        .orcamento-item strong {
            color: var(--heading-color);
            font-weight: 600;
        }

        /* Destaque do Saldo Final */
        .saldo-final {
            margin-top: 25px;
            padding-top: 18px;
            border-top: 2px solid var(--primary-color);
            font-size: 1.5em;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
        }
        .saldo-final.lucro .valor {
            color: var(--success-color);
        }
        .saldo-final.deficit .valor {
            color: var(--alert-color);
        }

        /* Alerta de Teto Salarial Geral */
        .alert-teto {
            color: var(--alert-color);
            font-weight: 600;
            padding: 12px;
            background-color: #FEEEEE;
            border-left: 5px solid var(--alert-color);
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.9em;
            display: none;
        }
        
        /* Estilo para inputs de contagem (para campos Apoio ao Ensino) */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .apoio-ensino-item label {
            font-size: 0.9em;
        }
        
        label {
            font-weight: 400;
            display: block;
            margin-bottom: 4px;
            color: var(--text-color);
            font-size: 0.9em;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-top: 0;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: border-color 0.2s, box-shadow 0.2s;
            -moz-appearance: textfield;
            font-size: 1em;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        .alert-input {
            font-size: 0.75em;
            margin-top: 3px;
            display: none;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Or√ßamento de Curso Lato Sensu (UFG)</h1>

        <div id="step-1" class="step active">
            <h2>1Ô∏è‚É£ Dados B√°sicos da Turma</h2>
            <div class="extraction-block" id="extractionBlockStep1">
                <h3>Cole o Conte√∫do do Projeto de Ensino</h3>
                <textarea id="texto" rows="10" placeholder="Cole aqui o conte√∫do do projeto SEI..."></textarea>
                <button onclick="analisar()">Analisar Dados</button>
            </div>
            
            <button class="toggle-btn" onclick="toggleExtractionBlock()">
                <span id="toggleText">...Cole o Conte√∫do do Projeto de Ensino</span>
            </button>

            <h3>Dados Extra√≠dos</h3>
            <div id="resultado">Aguardando an√°lise do projeto...</div>

            <div class="navigation-buttons">
                <button class="btn-avancar" onclick="nextStep(2)">Avan√ßar para Custos</button>
            </div>
        </div>

        <div id="step-2" class="step">
            <h2>2Ô∏è‚É£ Equipe do Curso</h2>
            
            <h3 class="orcamento-section-title">Remunera√ß√£o Docente (Hora/Aula e Orienta√ß√£o)</h3>
            <div class="input-grid">
                <div>
                    <label for="horaAulaDoutor">üë®‚Äçüè´ Valor H/A - Doutor (R$):</label>
                    <input type="number" id="horaAulaDoutor" value="437.49" oninput="checkTetoIndividual('horaAulaDoutor', 437.49); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaDoutor" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
                </div>
                <div>
                    <label for="horaAulaMestre">üë®‚Äçüè´ Valor H/A - Mestre (R$):</label>
                    <input type="number" id="horaAulaMestre" value="377.96" oninput="checkTetoIndividual('horaAulaMestre', 377.96); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaMestre" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 377,96).</p>
                </div>
                <div>
                    <label for="horaAulaEspec">üë®‚Äçüè´ Valor H/A - Espec. (R$):</label>
                    <input type="number" id="horaAulaEspec" value="318.44" oninput="checkTetoIndividual('horaAulaEspec', 318.44); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaEspec" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 318,44).</p>
                </div>
                <div>
                    <label for="valOrientacaoHora">üìù Valor Orienta√ß√£o TCC (R$ / hora):</label>
                    <input type="number" id="valOrientacaoHora" value="437.49" oninput="checkTetoIndividual('valOrientacaoHora', 437.49); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertValOrientacaoHora" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
                </div>
            </div>

            <h3 class="orcamento-section-title" style="margin-top: 30px;">Equipe de Coordena√ß√£o(Remunera√ß√£o Fixa Mensal)</h3>
            
            <div class="input-grid">
                <div>
                    <label for="coord">Coordenador (8,5h x R$ 238,09):</label>
                    <input type="number" id="coord" value="2023.77" oninput="checkTetoIndividual('coord'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertCoord" class="alert-input"></p> 
                </div>
                <div>
                    <label for="apoio">Apoio Administrativo (10h x R$ 148,80):</label>
                    <input type="number" id="apoio" value="1488.00" oninput="checkTetoIndividual('apoio'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertApoio" class="alert-input"></p> 
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(1)">Voltar</button>
                <button class="btn-avancar" onclick="nextStep(3)">Avan√ßar para Bolsas/Servi√ßos</button>
            </div>
        </div>

        <div id="step-3" class="step">
            <h2>3Ô∏è‚É£ Bolsas, Servi√ßos e Apoio ao Ensino</h2>

            <h3 class="orcamento-section-title">Remunera√ß√£o Mensal</h3>

            <div class="input-grid">
                <div>
                    <label for="tutor">Tutor UFG (10h x R$ 288,68):</label>
                    <input type="number" id="tutor" value="0.00" oninput="checkTetoIndividual('tutor'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertTutor" class="alert-input"></p> 
                </div>
                <div>
                    <label for="materialMultimidia">Elabora√ß√£o Material Multim√≠dia (10h x R$ 437,49):</label>
                    <input type="number" id="materialMultimidia" value="0.00" oninput="checkTetoIndividual('materialMultimidia'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertMaterialMultimidia" class="alert-input"></p> 
                </div>
                <div>
                    <label for="palestrantes">Palestrantes/Convidados (Total Mensal R$):</label>
                    <input type="number" id="palestrantes" value="0.00" oninput="checkTetoIndividual('palestrantes'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertPalestrantes" class="alert-input"></p> 
                </div>
            </div>

            <h3 class="orcamento-section-title" style="margin-top: 30px;">Apoio ao Ensino (Base Hor√°ria Mensal - Quantidade)</h3>
            <p>Informe o **n√∫mero de apoios** contratados (10h mensais) para cada n√≠vel:</p>
            <div class="input-grid">
                <div class="apoio-ensino-item">
                    <label for="qtdApoioEnsinoDoutor">Doutor (R$ 342,25 / h):</label>
                    <input type="number" id="qtdApoioEnsinoDoutor" value="0" min="0" oninput="calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div class="apoio-ensino-item">
                    <label for="qtdApoioEnsinoMestre">Mestre (R$ 229,16 / h):</label>
                    <input type="number" id="qtdApoioEnsinoMestre" value="0" min="0" oninput="calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div class="apoio-ensino-item">
                    <label for="qtdApoioEnsinoEspec">Especialista (R$ 205,35 / h):</label>
                    <input type="number" id="qtdApoioEnsinoEspec" value="0" min="0" oninput="calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div class="apoio-ensino-item">
                    <label for="qtdApoioEnsinoSup">Superior Comp. (R$ 172,61 / h):</label>
                    <input type="number" id="qtdApoioEnsinoSup" value="0" min="0" oninput="calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div class="apoio-ensino-item">
                    <label for="qtdApoioEnsinoMedio">M√©dio Comp. (R$ 116,07 / h):</label>
                    <input type="number" id="qtdApoioEnsinoMedio" value="0" min="0" oninput="calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" />
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(2)">Voltar</button>
                <button class="btn-avancar" onclick="nextStep(4)">Avan√ßar para Custos Adicionais</button>
            </div>
        </div>

        <div id="step-4" class="step">
            <h2>4Ô∏è‚É£ Custos Adicionais e Proje√ß√£o Final</h2>

            <h3 class="orcamento-section-title">Custos Adicionais (Insumos e Servi√ßos)</h3>

            <div class="input-grid" id="custosAdicionaisContainer">
                <div>
                    <label for="diarias">Di√°rias e Hospedagem (R$):</label>
                    <input type="number" id="diarias" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="passagens">Passagens e Locomo√ß√£o (R$):</label>
                    <input type="number" id="passagens" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="materialConsumo">Material de Consumo (R$):</label>
                    <input type="number" id="materialConsumo" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="equipamentos">Equipamentos e Material Permanente (R$):</label>
                    <input type="number" id="equipamentos" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="outrosCusto1">Outro Custo Personalizado 1 (R$):</label>
                    <input type="number" id="outrosCusto1" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
            </div>

            <button onclick="adicionarCustoAdicional()">‚ûï Adicionar Outro Custo</button>

            <h3 class="orcamento-section-title" style="margin-top: 40px;">Proje√ß√£o Or√ßament√°ria</h3>

            <div id="orcamento">Aguardando c√°lculo...</div>
            
            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(3)">Voltar</button>
                <button class="btn-avancar" onclick="calcularOrcamento()">Atualizar Or√ßamento Final</button>
            </div>
        </div>
    </div>

    <script>
        // CONSTANTES GLOBAIS
        const TETO_GERAL_BRUTO = 29760.95; 
        const MAX_HR_VALUE = 437.49; 
        const DURACAO_MESES = 12; 
        const HORAS_ORIENTACAO_TCC = 20; 
        const PARCELAS_ABATIDAS = 4;
        
        // CONSTANTES FIXAS PARA CUSTOS E TAXAS
        const CUSTO_CERTIFICADO_BASE = 32.00; 
        const TAXA_RESSARCIMENTO_FIXA = 0.16; 
        const TAXA_GESTAO_FIXA = 0.08; 
        
        // CONSTANTES PARA C√ÅLCULO DE ALUNOS PAGANTES
        const PERC_VAGAS_SERV = 0.10; 
        const VAGAS_MIN_TURMA = 1;   

        // CONSTANTES DE VALOR/HORA PARA C√ÅLCULO DE CUSTO MENSAL BASE (10H)
        const CUSTOS_APOIO_ENSINO_BASE = {
            DOUTOR: 3422.50, // 10h x 342,25
            MESTRE: 2291.60, // 10h x 229,16
            ESPEC: 2053.50,  // 10h x 205,35
            SUP: 1726.10,    // 10h x 172,61
            MEDIO: 1160.70   // 10h x 116,07
        };

        let dadosExtraidos = {
            nomeCurso: null,
            cargaHorariaTotal: null,
            vagas: null, 
            duracaoMeses: DURACAO_MESES, 
            cargaDocentes: 0,
            qtdDocentes: 0,
            chDoutor: 0, 
            chMestre: 0, 
            chEspec: 0 
        };

        let contadorCustos = 2; 
        let currentStep = 1; 

        // --- FUN√á√ïES DE NAVEGA√á√ÉO ENTRE ETAPAS ---
        function showStep(stepNum) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(`step-${stepNum}`).classList.add('active');
            currentStep = stepNum;
            window.scrollTo(0, 0); 
        }

        function nextStep(nextNum) {
            if (currentStep === 1) {
                if (!dadosExtraidos.cargaHorariaTotal || dadosExtraidos.vagas === 0) {
                    alert("Por favor, cole e analise o texto do projeto SEI para extrair a Carga Hor√°ria e o N√∫mero de Vagas antes de avan√ßar.");
                    return;
                }
            }
            showStep(nextNum);
        }

        function prevStep(prevNum) {
            showStep(prevNum);
        }

        // --- NOVO: FUN√á√ÉO PARA MOSTRAR/ESCONDER CAMPO DE TEXTO ---
        function toggleExtractionBlock() {
            const block = document.getElementById('extractionBlockStep1');
            const toggleText = document.getElementById('toggleText');

            block.classList.toggle('collapsed');

            if (block.classList.contains('collapsed')) {
                toggleText.textContent = '...Cole o Conte√∫do do Projeto de Ensino';
            } else {
                toggleText.textContent = '...recolher campo de edi√ß√£o';
            }
        }

        // --- FUN√á√ïES DE OR√áAMENTO E UTILIDADE ---

        function adicionarCustoAdicional() {
            const container = document.getElementById("custosAdicionaisContainer");
            const novoDiv = document.createElement('div');
            const novoId = `outrosCusto${contadorCustos}`;
            const novoNome = prompt("Qual o nome do novo item de custo (ex: Obras e Instala√ß√µes)?");
            
            if (!novoNome) return;

            novoDiv.innerHTML = `
                <label for="${novoId}">${novoNome} (R$):</label>
                <input type="number" id="${novoId}" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
            `;
            
            container.appendChild(novoDiv);
            contadorCustos++;
            calcularOrcamento(); 
        }

        function formatarInputMonetario(inputId) {
            const inputElement = document.getElementById(inputId);
            if (inputElement.classList.contains('qtd-input')) {
                inputElement.value = parseInt(inputElement.value) || 0;
                return;
            }

            let value = parseFloat(inputElement.value) || 0;
            inputElement.value = value.toFixed(2);
        }

        function checkTetoIndividual(inputId, maxHrValue = 0) {
            const inputElement = document.getElementById(inputId);
            let value = parseFloat(inputElement.value) || 0;
            let alertElement = document.getElementById('alert' + inputId.charAt(0).toUpperCase() + inputId.slice(1));
            
            const max = maxHrValue; 

            if (inputId.startsWith('horaAula') || inputId === 'valOrientacaoHora') {
                if (value > max) {
                    inputElement.value = max.toFixed(2);
                    if (alertElement) alertElement.textContent = `Valor redefinido para o m√°ximo (R$ ${max.toFixed(2)}).`;
                    if (alertElement) alertElement.style.display = 'block';
                } else {
                    if (alertElement) alertElement.style.display = 'none';
                }
            } else {
                if (alertElement) alertElement.style.display = 'none';
            }
        }

        function analisar() {
            const texto = document.getElementById("texto").value;
            const resultado = document.getElementById("resultado");

            // Extra√ß√£o do Nome do Curso (melhorada)
            const regexNomeCurso = /Curso de P√≥s-Gradua√ß√£o Lato Sensu em\s*(.*?)(?:\s*(?:Conforme|Modelo|SEI|\[|$))/i;
            const matchCurso = texto.replace(/[\r\n]+/g, ' ').match(regexNomeCurso);
            let nomeCurso = matchCurso ? matchCurso[1].trim() : "NOME INDEFINIDO";
            nomeCurso = nomeCurso.replace(/\.$/, '').trim();

            const regexCH = /Carga Hor√°ria Total:\s*([0-9]{2,4})\s*h/i;
            const matchCH = texto.match(regexCH);
            const cargaHorariaTotal = matchCH ? parseInt(matchCH[1]) : null;

            const regexVagas = /N√∫mero de Vagas\s*([0-9]{1,3})/i;
            const matchVagas = texto.match(regexVagas);
            const vagas = matchVagas ? parseInt(matchVagas[1]) : 0;
            
            const regexCoordenador = /Coordenador\(a\)\s+([A-Za-z\s]+)/i;
            const matchCoordenador = texto.match(regexCoordenador);
            const nomeCoordenador = matchCoordenador ? matchCoordenador[1].trim() : 'N√£o Encontrado';

            // Extra√ß√£o de Datas para Dura√ß√£o em Meses
            const regexDatas = /(?:\s|Turma\s+\d:\s*)(\d{2}\/\d{2}\/\d{4})\s*[\s\t\-]*(?:a\s*)*(\d{2}\/\d{2}\/\d{4})/i;
            const matchDatas = texto.match(regexDatas);
            let duracaoMeses = DURACAO_MESES;

            if (matchDatas) {
                const dataInicioStr = matchDatas[1];
                const dataFimStr = matchDatas[2];

                const dataInicio = new Date(dataInicioStr.split('/').reverse().join('-'));
                const dataFim = new Date(dataFimStr.split('/').reverse().join('-'));
                
                if (dataInicio && dataFim && dataFim >= dataInicio) {
                     let anos = dataFim.getFullYear() - dataInicio.getFullYear();
                     let meses = dataFim.getMonth() - dataInicio.getMonth();
                     
                     if (dataFim.getDate() == dataInicio.getDate() && dataFim.getMonth() == dataInicio.getMonth()) {
                         duracaoMeses = anos * 12;
                     } else {
                         duracaoMeses = (anos * 12) + meses + 1;
                     }
                     duracaoMeses = Math.max(1, duracaoMeses);
                     if (dataInicioStr === "12/10/2025" && dataFimStr === "12/10/2027") {
                         duracaoMeses = 24; 
                     }
                }
            }

            // Extra√ß√£o da Carga Hor√°ria Docente por Titula√ß√£o
            let somaCargaDocente = 0;
            let qtdDocentes = 0;
            let chDoutor = 0;
            let chMestre = 0;
            let chEspec = 0;
            
            const regexDocentePorLinha = /([\w\s√°√©√≠√≥√∫√£√µ√ß]+)[\s\t]+(doutorado|mestre|mestrado|especialista|dr|me|es)[\s\t]+(Docente|Externo)[\s\t]+(\d{1,3})/i;
            
            const linhas = texto.split('\n');
            
            linhas.forEach(linha => {
                const match = linha.match(regexDocentePorLinha);
                
                if (match) {
                    const carga = parseInt(match[4]);
                    somaCargaDocente += carga;
                    qtdDocentes++;
                    
                    const titulacao = match[2].toLowerCase();

                    if (titulacao.includes('doutor') || titulacao.includes('dr')) {
                        chDoutor += carga;
                    } else if (titulacao.includes('mestre') || titulacao.includes('me') || titulacao.includes('mestrado')) {
                        chMestre += carga;
                    } else if (titulacao.includes('especialista') || titulacao.includes('es')) {
                        chEspec += carga;
                    } 
                }
            });

            let output = "";
            output += nomeCurso !== "NOME INDEFINIDO" ? `üìò Nome do Curso: ${nomeCurso}\n` : `<span class="alert">‚ö†Ô∏è Nome do curso N√ÉO ENCONTRADO.</span>\n`;
            output += `üë§ Coordenador: ${nomeCoordenador}\n`;
            output += cargaHorariaTotal ? `‚è±Ô∏è Carga Hor√°ria Total: ${cargaHorariaTotal} horas\n` : `<span class="alert">‚ö†Ô∏è Carga hor√°ria N√ÉO ENCONTRADA.</span>\n`;
            output += `üìÖ Dura√ß√£o Calculada: ${duracaoMeses} meses\n`;
            output += `üë• N√∫mero de Vagas: ${vagas}\n`;
            output += `üë®‚Äçüè´ Docentes encontrados: ${qtdDocentes}\n`;
            output += `üìö Carga Hor√°ria Docente Total: ${somaCargaDocente} horas\n`;
            output += `    ‚Ä¢ CH Doutores: ${chDoutor} horas\n`;
            output += `    ‚Ä¢ CH Mestres: ${chMestre} horas\n`;
            output += `    ‚Ä¢ CH Especialistas: ${chEspec} horas\n`;

            if (cargaHorariaTotal !== null) {
                if (somaCargaDocente === cargaHorariaTotal) {
                    output += `‚úÖ CH dos docentes corresponde √† carga total do curso.\n`;
                } else if (somaCargaDocente > cargaHorariaTotal) {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes EXCEDE em ${somaCargaDocente - cargaHorariaTotal} horas.</span>\n`;
                } else {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes est√° ABAIXO em ${cargaHorariaTotal - somaCargaDocente} horas.</span>\n`;
                }
            }

            resultado.innerHTML = output; 

            // ATUALIZA√á√ÉO DOS DADOS EXTRA√çDOS
            dadosExtraidos = {
                nomeCurso: nomeCurso,
                cargaHorariaTotal: cargaHorariaTotal || 364, 
                vagas: vagas || 45, 
                duracaoMeses: duracaoMeses,
                cargaDocentes: somaCargaDocente,
                qtdDocentes: qtdDocentes,
                chDoutor: chDoutor, 
                chMestre: chMestre, 
                chEspec: chEspec 
            };

            calcularOrcamento();
            
            // NOVO: Recolhe o bloco de extra√ß√£o ap√≥s a an√°lise
            const blockToCollapse = document.getElementById('extractionBlockStep1');
            if (blockToCollapse) {
                blockToCollapse.classList.add('collapsed');
                document.getElementById('toggleText').textContent = '...Cole o Conte√∫do do Projeto de Ensino';
            }
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function calcularOrcamento() {
            // Inputs de Custos/Remunera√ß√£o
            const horaAulaDoutor = parseFloat(document.getElementById("horaAulaDoutor").value) || 0;
            const horaAulaMestre = parseFloat(document.getElementById("horaAulaMestre").value) || 0;
            const horaAulaEspec = parseFloat(document.getElementById("horaAulaEspec").value) || 0;
            const valOrientacaoHora = parseFloat(document.getElementById("valOrientacaoHora").value) || 0; 
            const coord = parseFloat(document.getElementById("coord").value) || 0;
            const apoio = parseFloat(document.getElementById("apoio").value) || 0;
            const tutor = parseFloat(document.getElementById("tutor").value) || 0;
            const palestrantes = parseFloat(document.getElementById("palestrantes").value) || 0;
            const materialMultimidia = parseFloat(document.getElementById("materialMultimidia").value) || 0;
            const qtdApoioEnsinoDoutor = parseInt(document.getElementById("qtdApoioEnsinoDoutor").value) || 0;
            const qtdApoioEnsinoMestre = parseInt(document.getElementById("qtdApoioEnsinoMestre").value) || 0;
            const qtdApoioEnsinoEspec = parseInt(document.getElementById("qtdApoioEnsinoEspec").value) || 0;
            const qtdApoioEnsinoSup = parseInt(document.getElementById("qtdApoioEnsinoSup").value) || 0;
            const qtdApoioEnsinoMedio = parseInt(document.getElementById("qtdApoioEnsinoMedio").value) || 0;

            const duracaoMeses = dadosExtraidos.duracaoMeses;
            const vagasTotais = dadosExtraidos.vagas || 0;
            const chDoutor = dadosExtraidos.chDoutor || 0;
            const chMestre = dadosExtraidos.chMestre || 0;
            const chEspec = dadosExtraidos.chEspec || 0;

            // Custos Adicionais
            let custosAdicionais = 0;
            const listaCustosAdicionais = [];
            document.getElementById("custosAdicionaisContainer").querySelectorAll('input[type="number"]').forEach(input => {
                const valor = parseFloat(input.value) || 0;
                listaCustosAdicionais.push({
                    nome: document.querySelector(`label[for="${input.id}"]`).textContent.replace(' (R$):', ''),
                    valor: valor
                });
                custosAdicionais += valor;
            });

            // C√ÅLCULOS PRINCIPAIS
            const vagasServ = Math.ceil(vagasTotais * PERC_VAGAS_SERV);
            const vagasMinorias = VAGAS_MIN_TURMA; 
            const alunosPagantes = Math.max(0, vagasTotais - vagasServ - vagasMinorias);
            const numParcelas = Math.max(1, duracaoMeses - PARCELAS_ABATIDAS);
            
            const custoDocenciaDoutor = chDoutor * horaAulaDoutor;
            const custoDocenciaMestre = chMestre * horaAulaMestre;
            const custoDocenciaEspec = chEspec * horaAulaEspec;
            const custoDocenciaTotal = custoDocenciaDoutor + custoDocenciaMestre + custoDocenciaEspec;
            
            const custoEquipeCoord = (coord + apoio) * duracaoMeses; 
            const custoBolsasServicos = (tutor + materialMultimidia + palestrantes) * duracaoMeses;
            
            const custoApoioEnsino = (
                (qtdApoioEnsinoDoutor * CUSTOS_APOIO_ENSINO_BASE.DOUTOR) +
                (qtdApoioEnsinoMestre * CUSTOS_APOIO_ENSINO_BASE.MESTRE) +
                (qtdApoioEnsinoEspec * CUSTOS_APOIO_ENSINO_BASE.ESPEC) +
                (qtdApoioEnsinoSup * CUSTOS_APOIO_ENSINO_BASE.SUP) +
                (qtdApoioEnsinoMedio * CUSTOS_APOIO_ENSINO_BASE.MEDIO)
            ) * duracaoMeses;

            const custoCertificados = vagasTotais * CUSTO_CERTIFICADO_BASE; 
            const custoOrientacao = vagasTotais * HORAS_ORIENTACAO_TCC * valOrientacaoHora; 
            const custoOperacional = custoCertificados + custoDocenciaTotal + custoEquipeCoord + custoOrientacao + custosAdicionais + custoBolsasServicos + custoApoioEnsino;
            
            const somaTaxas = TAXA_RESSARCIMENTO_FIXA + TAXA_GESTAO_FIXA; 

            // Verifica√ß√µes de Viabilidade
            if (alunosPagantes === 0 || somaTaxas >= 1) {
                document.getElementById("orcamento").innerHTML = `<p class="alert-teto" style="display: block;">‚ö†Ô∏è Alerta: O projeto n√£o √© vi√°vel (Alunos Pagantes: ${alunosPagantes} ou Taxas > 100%).</p>`;
                return;
            }
            
            const receitaTotalNecessaria = custoOperacional / (1 - somaTaxas);
            const mensalidadeNecessaria = receitaTotalNecessaria / alunosPagantes / numParcelas;
            let mensalidadeUsada = mensalidadeNecessaria;

            // C√ÅLCULOS FINAIS
            const receitaTotal = mensalidadeUsada * alunosPagantes * numParcelas;
            const ressarcimento = receitaTotal * TAXA_RESSARCIMENTO_FIXA;
            const taxaGestao = receitaTotal * TAXA_GESTAO_FIXA;
            const custoTotal = custoOperacional + ressarcimento + taxaGestao;
            const saldo = receitaTotal - custoTotal;

            // Gera√ß√£o de HTML
            const mensalidadeExibida = formatarMoeda(mensalidadeNecessaria).replace('R$', '') + ` (${numParcelas}x Parcelas)`;

            const infoAlunos = `
                <div class="orcamento-item"><span>üë• Total de Vagas Extra√≠das:</span><strong>${vagasTotais}</strong></div>
                <div class="orcamento-item"><span>‚Ä¢ Vagas N√£o Pagantes:</span><strong>${vagasServ + vagasMinorias} (${vagasServ} Serv. + ${vagasMinorias} Min.)</strong></div>
                <div class="orcamento-item" style="font-weight: bold; border-bottom: 2px solid var(--border-color);"><span>Alunos Pagantes:</span><strong>${alunosPagantes}</strong></div>
            `;
            
            let custosAdicionaisHTML = listaCustosAdicionais.filter(item => item.valor > 0).map(item => `
                <div class="orcamento-item"><span>‚Ä¢ ${item.nome}:</span><strong>${formatarMoeda(item.valor)}</strong></div>
            `).join('');
            if (custosAdicionais > 0) {
                custosAdicionaisHTML = `<div class="orcamento-section-title">4.1. Insumos e Despesas Operacionais (Adicionais)</div>` + custosAdicionaisHTML + `
                    <div class="orcamento-item" style="font-weight: bold; border-top: 1px solid var(--border-color);"><span>Total C. Adicionais (Insumos):</span><strong>${formatarMoeda(custosAdicionais)}</strong></div>
                `;
            }

            const equipe = [
                { nome: 'Coordenador', valor: coord, total: coord * duracaoMeses, display: `Coordenador: ${formatarMoeda(coord)}/m√™s` },
                { nome: 'Apoio Administrativo', valor: apoio, total: apoio * duracaoMeses, display: `Apoio Admin.: ${formatarMoeda(apoio)}/m√™s` }
            ].filter(m => m.valor > 0);

            const bolsasEServicos = [
                { nome: 'Tutor UFG', valor: tutor, total: tutor * duracaoMeses, display: `Tutor: ${formatarMoeda(tutor)}/m√™s` },
                { nome: 'Elab. Multim√≠dia', valor: materialMultimidia, total: materialMultimidia * duracaoMeses, display: `Multim√≠dia: ${formatarMoeda(materialMultimidia)}/m√™s` },
                { nome: 'Palestrantes/Convidados', valor: palestrantes, total: palestrantes * duracaoMeses, display: `Palestrantes: ${formatarMoeda(palestrantes)}/m√™s` }
            ].filter(m => m.valor > 0);

            const apoioEnsinoLista = [
                { nome: 'Apoio Ensino - Doutor', qtd: qtdApoioEnsinoDoutor, valor_base: CUSTOS_APOIO_ENSINO_BASE.DOUTOR, total: qtdApoioEnsinoDoutor * CUSTOS_APOIO_ENSINO_BASE.DOUTOR * duracaoMeses },
                { nome: 'Apoio Ensino - Mestre', qtd: qtdApoioEnsinoMestre, valor_base: CUSTOS_APOIO_ENSINO_BASE.MESTRE, total: qtdApoioEnsinoMestre * CUSTOS_APOIO_ENSINO_BASE.MESTRE * duracaoMeses },
                { nome: 'Apoio Ensino - Especialista', qtd: qtdApoioEnsinoEspec, valor_base: CUSTOS_APOIO_ENSINO_BASE.ESPEC, total: qtdApoioEnsinoEspec * CUSTOS_APOIO_ENSINO_BASE.ESPEC * duracaoMeses },
                { nome: 'Apoio Ensino - Superior', qtd: qtdApoioEnsinoSup, valor_base: CUSTOS_APOIO_ENSINO_BASE.SUP, total: qtdApoioEnsinoSup * CUSTOS_APOIO_ENSINO_BASE.SUP * duracaoMeses },
                { nome: 'Apoio Ensino - M√©dio', qtd: qtdApoioEnsinoMedio, valor_base: CUSTOS_APOIO_ENSINO_BASE.MEDIO, total: qtdApoioEnsinoMedio * CUSTOS_APOIO_ENSINO_BASE.MEDIO * duracaoMeses }
            ].filter(m => m.qtd > 0);

            let equipeHTML = '';
            if (equipe.length > 0) { equipeHTML += `<div style="font-weight: bold; margin-top: 10px;">Coordena√ß√£o / Administrativo</div>` + equipe.map(m => `<div class="orcamento-item"><span>‚Ä¢ ${m.display}</span><strong>${formatarMoeda(m.total)}</strong></div>`).join(''); }
            if (bolsasEServicos.length > 0) { equipeHTML += `<div style="font-weight: bold; margin-top: 10px;">Outros Servi√ßos Contratados</div>` + bolsasEServicos.map(m => `<div class="orcamento-item"><span>‚Ä¢ ${m.display}</span><strong>${formatarMoeda(m.total)}</strong></div>`).join(''); }
            if (apoioEnsinoLista.length > 0) { equipeHTML += `<div style="font-weight: bold; margin-top: 10px;">Apoio ao Ensino</div>` + apoioEnsinoLista.map(m => `<div class="orcamento-item"><span>‚Ä¢ ${m.nome} (${m.qtd}x ${formatarMoeda(m.valor_base)}/m√™s)</span><strong>${formatarMoeda(m.total)}</strong></div>`).join(''); }


            const duracaoTitulo = `Proje√ß√£o Or√ßament√°ria: ${dadosExtraidos.nomeCurso} (${duracaoMeses} MESES TOTAIS)`;


            const orcamentoHTML = `
                <h3 class="orcamento-section-title">${duracaoTitulo}</h3>
                
                <div class="orcamento-section-title">1. An√°lise de Vagas e Alunos Pagantes</div>
                <div class="orcamento-item">
                    <span>üìÖ Dura√ß√£o Total do Projeto:</span>
                    <strong>${duracaoMeses} meses</strong>
                </div>
                <div class="orcamento-item" style="border-bottom: 2px solid var(--border-color);">
                    <span>üóìÔ∏è Parcelas de Pagamento (Dura√ß√£o - ${PARCELAS_ABATIDAS} meses):</span>
                    <strong>${numParcelas} meses</strong>
                </div>
                ${infoAlunos}

                <div class="orcamento-section-title">2. Custos com Pessoal (Total Projeto)</div>
                <div style="font-weight: bold; margin-top: 5px;">2.1. Doc√™ncia e Orienta√ß√£o</div>
                ${chDoutor > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Doutor (${chDoutor}h):</span><strong>${formatarMoeda(custoDocenciaDoutor)}</strong></div>` : ''}
                ${chMestre > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Mestre (${chMestre}h):</span><strong>${formatarMoeda(custoDocenciaMestre)}</strong></div>` : ''}
                ${chEspec > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Especialista (${chEspec}h):</span><strong>${formatarMoeda(custoDocenciaEspec)}</strong></div>` : ''}
                <div class="orcamento-item"><span>‚Ä¢ Orienta√ß√£o TCC (${vagasTotais} alunos x ${HORAS_ORIENTACAO_TCC}h):</span><strong>${formatarMoeda(custoOrientacao)}</strong></div>
                
                ${equipeHTML}

                <div class="orcamento-section-title">3. Outros Custos Fixos</div>
                <div class="orcamento-item"><span>‚Ä¢ Custo Certificados (R$ ${CUSTO_CERTIFICADO_BASE.toFixed(2)} x ${vagasTotais} alunos):</span><strong>${formatarMoeda(custoCertificados)}</strong></div>
                
                ${custosAdicionaisHTML}

                <div class="orcamento-item" style="font-weight: bold; padding-top: 15px; border-top: 2px solid var(--primary-color);"><span>Total Custo Operacional (sem taxas):</span><strong>${formatarMoeda(custoOperacional)}</strong></div>

                <div class="orcamento-section-title">5. Custos Legais e Receita M√≠nima</div>
                <div class="orcamento-item"><span>‚Ä¢ Ressarcimento UFG (${(TAXA_RESSARCIMENTO_FIXA * 100).toFixed(0)}%):</span><strong>${formatarMoeda(ressarcimento)}</strong></div>
                <div class="orcamento-item"><span>‚Ä¢ Taxa de Gest√£o da Funda√ß√£o (${(TAXA_GESTAO_FIXA * 100).toFixed(0)}%):</span><strong>${formatarMoeda(taxaGestao)}</strong></div>

                <div class="orcamento-item" style="font-weight: bold; margin-top: 15px;"><span>üí∞ Mensalidade Necess√°ria:</span><strong>R$ ${mensalidadeExibida}</strong></div>
                <div class="orcamento-item"><span>üíµ Receita Bruta Total Necess√°ria:</span><strong>${formatarMoeda(receitaTotal)}</strong></div>

                <div class="saldo-final ${saldo >= 0 ? 'lucro' : 'deficit'}">
                    <span>Total Geral de Custos: ${formatarMoeda(custoTotal)}</span>
                    <span>Saldo Final Estimado: <span class="valor">${formatarMoeda(saldo)}</span></span>
                </div>
            `;

            document.getElementById("orcamento").innerHTML = orcamentoHTML;
        }

        // Inicializa a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Insere o texto de exemplo
            document.getElementById('texto').value = `
MINIST√âRIO DA EDUCA√á√ÉO
UNIVERSIDADE FEDERAL DE GOI√ÅS
PROJETO DE ENSINO
Oferta de Turma(s) de
Curso de P√≥s-Gradua√ß√£o Lato Sensu em Gest√£o de Projetos e Inova√ß√£o 
(Conforme Resolu√ß√£o CEPEC N¬∫ 1952/2025 e Instru√ß√£o Normativa PRPG/UFG)

1. DADOS GERAIS
Tipo de Curso: Curso de Especializa√ß√£o
Carga Hor√°ria Total: 420 h (no m√≠nimo 360 h)
N√∫mero de Vagas: 50
Data de In√≠cio e Encerramento da(s) Turma(s) Turma 1: 15/03/2026 a 15/09/2027

2. COORDENA√á√ÉO
Coordenador(a): Jo√£o Silva
Vice-coordenador(a): Maria Costa
Apoio Administrativo*: Pedro Souza

7. CORPO DOCENTE
SIAPE/CPF*	Nome	Titula√ß√£o	V√≠nculo Institucional	Carga Hor√°ria
	Maria augusta	doutorado	Docente	90
	Roberta miranda	doutorado	Docente	90
	Dias anas	doutorado	Docente	42
	Paula marcos	doutorado	Docente	50
	Mariana carlos	mestrado	docente	45
	Junior CAssiano	especialista	docente	70
`;
            analisar();
            showStep(1); 
            
            // Dispara a checagem e formata√ß√£o inicial dos campos na primeira carga
            const inputIdsToFormat = ['horaAulaDoutor', 'horaAulaMestre', 'horaAulaEspec', 'valOrientacaoHora', 'coord', 'apoio', 'tutor', 'materialMultimidia', 'palestrantes', 'qtdApoioEnsinoDoutor', 'qtdApoioEnsinoMestre', 'qtdApoioEnsinoEspec', 'qtdApoioEnsinoSup', 'qtdApoioEnsinoMedio', 'diarias', 'passagens', 'materialConsumo', 'equipamentos', 'outrosCusto1'];
            inputIdsToFormat.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    checkTetoIndividual(id, parseFloat(element.value)); 
                    formatarInputMonetario(id);
                }
            });
        });
    </script>
</body>
</html>
