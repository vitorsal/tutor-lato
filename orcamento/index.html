<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Or√ßamento de Curso Lato Sensu - Passo a Passo</title>
    
    <style>
        /* ==================== */
        /* VARI√ÅVEIS DE CORES (TEMA: PRPG UFG - VERDE/BRANCO) */
        /* ==================== */
        :root {
            --primary-color: #1A5228; /* Verde Escuro Profundo (Mais sofisticado que o #38761D) */
            --secondary-color: #FFFFFF;
            --text-color: #212529; /* Preto mais suave para texto */
            --heading-color: #1A5228; /* Mesmo verde prim√°rio para t√≠tulos */
            --bg-neutral: #F5F5F5; /* Fundo levemente mais claro */
            --border-color: #E0E0E0; /* Linhas mais finas e suaves */
            --alert-color: #C0392B; /* Vermelho mais s√≥brio */
            --success-color: #27AE60; /* Verde de sucesso mais vibrante */
            --highlight-bg: #EAF7ED; /* Fundo de destaque suave, pr√≥ximo ao branco */
            /* REVIS√ÉO MINIMALISTA */
            --font-primary: 'Helvetica Neue', Arial, sans-serif; /* Fonte moderna e limpa */
        }

        body {
            font-family: var(--font-primary);
            padding: 0;
            background: var(--bg-neutral);
            color: var(--text-color);
            margin: 0;
            line-height: 1.5;
            font-size: 16px;
        }

        .container {
            width: 90%;
            max-width: 960px;
            margin: 50px auto;
            padding: 40px;
            background-color: var(--secondary-color);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        /* --- T√çTULO PRINCIPAL --- */
        h1 {
            color: var(--primary-color);
            text-align: left;
            /* REDU√á√ÉO DO TAMANHO DA FONTE */
            font-size: 1.8em; 
            margin-bottom: 12px; /* Redu√ß√£o da margem inferior */
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            font-weight: 400; /* Levemente mais leve */
        }
        /* Ajuste do tamanho e cor do √≠cone */
        h1 .icon {
            font-size: 1.1em; /* Ajuste no √≠cone para acompanhar */
            color: var(--primary-color);
            margin-right: 8px;
        }

        /* --- CONTROLE DE ETAPAS --- */
        .step {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
            padding-top: 10px;
        }
        .step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .navigation-buttons .btn-avancar {
            margin-left: auto;
        }
        .navigation-buttons .btn-voltar {
            background-color: #6c757d;
        }
        .navigation-buttons .btn-voltar:hover {
            background-color: #5a6268;
        }

        /* --- T√çTULOS DE SE√á√ÉO --- */
        h2 {
            margin-top: 35px;
            color: var(--heading-color);
            font-size: 1.5em;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        /* NOVO ESTILO: Tira o emoji e insere um n√∫mero estilizado */
        h2:before {
            content: attr(data-step);
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: var(--primary-color); /* Fundo Verde */
            color: var(--secondary-color); /* Texto Branco */
            font-size: 0.8em;
            font-weight: 700;
            margin-right: 12px;
            flex-shrink: 0; /* Evita que o n√∫mero seja esmagado */
        }
        
        /* --- BLOCO DE EXTRA√á√ÉO (SE√á√ÉO 1) --- */
        .extraction-block {
            background: var(--highlight-bg);
            padding: 25px;
            border-radius: 6px;
            border: 1px solid #D0EAD6;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
            margin-bottom: 20px;
            overflow: hidden; 
            max-height: 500px; 
        }
        .extraction-block h3 {
            margin-top: 0;
        }
        /* Classe para recolher o bloco */
        .extraction-block.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-bottom: 0;
            border: 1px solid transparent;
        }
        
        /* Estilo para o bot√£o de toggle/visualizar */
        .toggle-btn {
            background: none;
            color: var(--primary-color);
            padding: 0;
            margin: 0;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            text-transform: none;
            letter-spacing: normal;
            display: block;
            text-align: left;
            border: none;
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 3px;
            transition: color 0.2s;
        }
        .toggle-btn:hover {
            color: var(--heading-color);
            transform: none;
        }

        textarea {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85em;
            min-height: 120px;
            resize: vertical;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 10px 20px;
            margin-top: 10px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover {
            background-color: var(--heading-color);
            transform: translateY(-1px);
        }

        /* REVIS√ÉO MINIMALISTA: Oculta dados extra√≠dos e bot√µes de navega√ß√£o inicial */
        .hidden-before-analysis {
            display: none;
        }

        #resultado {
            padding: 15px 0;
            white-space: pre-wrap;
            font-size: 0.9em;
            color: var(--text-color);
            margin-bottom: 20px;
        }
        #resultado .alert {
            color: var(--alert-color);
            font-weight: bold;
        }

        /* --- RESULTADOS OR√áAMENT√ÅRIOS (SE√á√ÉO 3) --- */
        #orcamento {
            margin-top: 40px;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: #FAFAFA;
        }
        
        .orcamento-section-title {
            color: var(--primary-color);
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            font-weight: 500;
        }
        
        .orcamento-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
            font-size: 0.95em;
        }
        
        .orcamento-item strong {
            color: var(--heading-color);
            font-weight: 600;
        }

        /* Destaque do Saldo Final */
        .saldo-final {
            margin-top: 25px;
            padding-top: 18px;
            border-top: 2px solid var(--primary-color);
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
        }
        .saldo-final.lucro .valor {
            color: var(--success-color);
        }
        .saldo-final.deficit .valor {
            color: var(--alert-color);
        }

        /* Estilo para Tabela de Equipe (NOVO) */
        .equipe-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .equipe-table th, .equipe-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }
        .equipe-table th {
            background-color: var(--highlight-bg);
            color: var(--heading-color);
            font-weight: 600;
        }
        .equipe-table td:last-child {
            text-align: right;
            font-weight: bold;
            color: var(--heading-color);
        }

        /* Tabela de Docentes no Resumo (Etapa 1) */
        #docente-resumo-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        #docente-resumo-table th, #docente-resumo-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
            font-size: 0.85em;
        }
        #docente-resumo-table th {
            background-color: #F0F0F0;
            font-weight: 600;
        }

        /* Alerta de Teto Salarial Geral */
        .alert-teto {
            color: var(--alert-color);
            font-weight: 600;
            padding: 12px;
            background-color: #FEEEEE;
            border-left: 5px solid var(--alert-color);
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.9em;
            display: none;
        }
        
        /* Estilo para inputs de contagem (para campos Apoio ao Ensino) */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .apoio-ensino-consolidado {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background-color: var(--highlight-bg);
            border-radius: 6px;
        }
        .apoio-input-group {
             display: flex;
             gap: 8px;
             align-items: center;
        }
        .apoio-input-group input.qtd-input {
            width: 100%;
            text-align: center;
        }
        .apoio-input-group input.valor-input {
            width: 100%;
            text-align: right; 
        }
        .apoio-ensino-item {
             /* Estilo para os campos de distribui√ß√£o condicional */
             margin-top: 10px;
        }
        .justificativa-alert {
            color: var(--alert-color);
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        label {
            font-weight: 400;
            display: block;
            margin-bottom: 4px;
            color: var(--text-color);
            font-size: 0.9em;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-top: 0;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: border-color 0.2s, box-shadow 0.2s;
            -moz-appearance: textfield;
            font-size: 1em;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        .alert-input {
            font-size: 0.75em;
            margin-top: 3px;
            display: none;
        }

        /* NOVO: Estilo para Rodap√© de Contato */
        .footer-contact {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.85em;
            color: #6c757d;
        }
        .footer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .footer-contact a:hover {
            text-decoration: underline;
        }

        
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="icon">üßÆ</span> Or√ßamento de Curso Lato Sensu (UFG)</h1>

        <div id="step-1" class="step active">
            <h2 data-step="1">Dados B√°sicos da Turma</h2>
            <div class="extraction-block" id="extractionBlockStep1">
                <h3>1. COLE O PROJETO DE ENSINO COMPLETO</h3>
                <textarea id="texto" rows="10" placeholder="Cole aqui o conte√∫do do projeto SEI..."></textarea>
                <button onclick="analisar()">Analisar Dados</button>
            </div>
            
            <div class="hidden-before-analysis" id="toggleButtonContainer">
                <button class="toggle-btn" onclick="toggleExtractionBlock()">
                    <span id="toggleText">...revelar campo para edi√ß√£o/novo projeto</span>
                </button>
            </div>

            <h3 class="hidden-before-analysis" id="dadosExtraidosTitle">Dados Extra√≠dos do Projeto de Ensino</h3>
            <div id="resultado" class="hidden-before-analysis">Aguardando an√°lise do projeto...</div>

            <div class="navigation-buttons hidden-before-analysis" id="navigationButtonContainer">
                <button class="btn-avancar" onclick="nextStep(2)">Avan√ßar para Custos</button>
            </div>
        </div>

        <div id="step-2" class="step">
            <h2 data-step="2">Docentes e Coordena√ß√£o</h2>
            
            <h3 class="orcamento-section-title">Remunera√ß√£o: Doc√™ncia (Hora-Aula) e Orienta√ß√£o</h3>
            <div class="input-grid">
                <div>
                    <label for="horaAulaDoutor">üë®‚Äçüè´ Valor H/A - Doutor (R$):</label>
                    <input type="number" id="horaAulaDoutor" value="437.49" oninput="checkTetoIndividual('horaAulaDoutor', 437.49); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaDoutor" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
                </div>
                <div>
                    <label for="horaAulaMestre">üë®‚Äçüè´ Valor H/A - Mestre (R$):</label>
                    <input type="number" id="horaAulaMestre" value="377.96" oninput="checkTetoIndividual('horaAulaMestre', 377.96); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaMestre" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 377,96).</p>
                </div>
                <div>
                    <label for="horaAulaEspec">üë®‚Äçüè´ Valor H/A - Espec. (R$):</label>
                    <input type="number" id="horaAulaEspec" value="318.44" oninput="checkTetoIndividual('horaAulaEspec', 318.44); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertHoraAulaEspec" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 318,44).</p>
                </div>
                <div>
                    <label for="valOrientacaoHora">üìù Valor Orienta√ß√£o TCC (R$ / hora):</label>
                    <input type="number" id="valOrientacaoHora" value="437.49" oninput="checkTetoIndividual('valOrientacaoHora', 437.49); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertValOrientacaoHora" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
                </div>
            </div>

            <h3 class="orcamento-section-title" style="margin-top: 30px;">Remunera√ß√£o: Coordena√ß√£o(Valor fixo mensal)</h3>
            
            <div class="input-grid">
                <div>
                    <label for="coord">Coordenador (Valor teto 8,5h x R$ 238,09):</label>
                    <input type="number" id="coord" value="2023.77" oninput="checkTetoIndividual('coord', 2023.77); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertCoord" class="alert-input">Valor excede o limite m√°ximo mensal (R$ 2.023,77).</p> 
                </div>
                <div>
                    <label for="apoio">Apoio Administrativo (Valor teto 10h x R$ 148,80):</label>
                    <input type="number" id="apoio" value="1488.00" oninput="checkTetoIndividual('apoio', 1488.00); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertApoio" class="alert-input">Valor excede o limite m√°ximo mensal (R$ 1.488,00).</p> 
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(1)">Voltar</button>
                <button class="btn-avancar" onclick="nextStep(3)">Avan√ßar para Bolsas/Servi√ßos</button>
            </div>
        </div>

        <div id="step-3" class="step">
            <h2 data-step="3">Apoio ao Ensino</h2>

            <h3 class="orcamento-section-title" style="margin-top: 0;">Quantidade de apoio e o valor mensal</h3>
            
            <div class="apoio-ensino-consolidado">
                <div class="input-grid" style="margin-top: 0; grid-template-columns: 1fr 1fr;">
                    <div class="apoio-input-group" style="flex-direction: column; align-items: start; gap: 0;">
                        <label for="qtdApoioEnsinoTotal">Quantidade Total de Apoios:</label>
                        <input type="number" id="qtdApoioEnsinoTotal" value="0" min="0" oninput="checkApoioUnicoValue(); calcularOrcamento()" class="qtd-input" onblur="formatarInputMonetario(this.id)" placeholder="Ex: 4" />
                    </div>
                    <div class="apoio-input-group" style="flex-direction: column; align-items: start; gap: 0;">
                        <label for="valApoioEnsinoUnico">Valor Mensal POR APOIO (R$):</label>
                        <input type="number" id="valApoioEnsinoUnico" value="1500.00" oninput="checkTetoIndividual('valApoioEnsinoUnico', 3422.50); checkApoioUnicoValue(); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" class="valor-input" placeholder="Ex: 1500.00" />
                        <p id="alertValApoioEnsinoUnico" class="alert-input">Valor excede o limite m√°ximo mensal (R$ 3.422,50).</p>
                    </div>
                </div>

                <div id="apoioJustificativa" class="apoio-ensino-item hidden-before-analysis">
                    <p class="justificativa-alert">
                        ‚ö†Ô∏è **Justificativa de Teto:** O valor mensal ultrapassa R$ 1.726,10 (Teto Superior Comp.). Distribua a Qtd Total de Apoios entre os n√≠veis abaixo para verificar o teto individual:
                    </p>
                    
                    <div class="input-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div>
                            <label for="qtdDoutorJust">Qtd Doutor (Teto: 3.422,50):</label>
                            <input type="number" id="qtdDoutorJust" value="0" min="0" oninput="checkTotalApoios();" class="qtd-input" placeholder="0" />
                        </div>
                        <div>
                            <label for="qtdMestreJust">Qtd Mestre (Teto: 2.291,60):</label>
                            <input type="number" id="qtdMestreJust" value="0" min="0" oninput="checkTotalApoios();" class="qtd-input" placeholder="0" />
                        </div>
                        <div>
                            <label for="qtdEspecJust">Qtd Especialista (Teto: 2.053,50):</label>
                            <input type="number" id="qtdEspecJust" value="0" min="0" oninput="checkTotalApoios();" class="qtd-input" placeholder="0" />
                        </div>
                    </div>
                    <p id="alertApoioJustificativa" class="alert-input" style="display: none;"></p>
                </div>
            </div>

            <h3 class="orcamento-section-title" style="margin-top: 30px;">Outros</h3>

            <div class="input-grid">
                <div>
                    <label for="tutor">Tutor UFG (Valor teto 10h x R$ 288,68):</label>
                    <input type="number" id="tutor" value="0.00" oninput="checkTetoIndividual('tutor'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertTutor" class="alert-input"></p> 
                </div>
                <div>
                    <label for="materialMultimidia">Elabora√ß√£o Material Multim√≠dia (Valor teto 10h x R$ 437,49):</label>
                    <input type="number" id="materialMultimidia" value="0.00" oninput="checkTetoIndividual('materialMultimidia'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertMaterialMultimidia" class="alert-input"></p> 
                </div>
                <div>
                    <label for="palestrantes">Palestrantes/Convidados (Total R$):</label>
                    <input type="number" id="palestrantes" value="0.00" oninput="checkTetoIndividual('palestrantes'); calcularOrcamento();" onblur="formatarInputMonetario(this.id)" />
                    <p id="alertPalestrantes" class="alert-input"></p> 
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(2)">Voltar</button>
                <button class="btn-avancar" onclick="nextStep(4)">Avan√ßar para Custos Adicionais</button>
            </div>
        </div>

        <div id="step-4" class="step">
            <h2 data-step="4">Custos Adicionais (Insumos e Servi√ßos)</h2>

            <h3 class="orcamento-section-title">Despesas, materiais e servi√ßos</h3>

            <div class="input-grid" id="custosAdicionaisContainer">
                <div>
                    <label for="diarias">Di√°rias e Hospedagem (R$):</label>
                    <input type="number" id="diarias" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="passagens">Passagens e Locomo√ß√£o (R$):</label>
                    <input type="number" id="passagens" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="materialConsumo">Material de Consumo (R$):</label>
                    <input type="number" id="materialConsumo" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="equipamentos">Equipamentos e Material Permanente (R$):</label>
                    <input type="number" id="equipamentos" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
                <div>
                    <label for="outrosCusto1">Outro Custo Personalizado 1 (R$):</label>
                    <input type="number" id="outrosCusto1" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
                </div>
            </div>

            <button onclick="adicionarCustoAdicional()">‚ûï Adicionar Outro Custo</button>
            
            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(3)">Voltar</button>
                <button class="btn-avancar" onclick="nextStep(5)">Avan√ßar para Proje√ß√£o Final</button>
            </div>
        </div>

        <div id="step-5" class="step">
            <h2 data-step="5">Proje√ß√£o</h2>
            
            <div id="orcamento">Aguardando c√°lculo...</div>
            
            <div class="navigation-buttons">
                <button class="btn-voltar" onclick="prevStep(4)">Voltar</button>
                <button class="btn-avancar" onclick="imprimirOrcamento()">Finalizar e Gerar PDF</button>
            </div>
        </div>
    </div>

    <div class="footer-contact">
        Em caso de d√∫vidas, entre em contato com:
        <a href="mailto:administrativo.escoladepos@ufg.br">administrativo.escoladepos@ufg.br</a> | Telefone: (62) 3521-2780
    </div>

    <script>
        // CONSTANTES GLOBAIS
        const TETO_GERAL_BRUTO = 29760.95; 
        const MAX_HR_VALUE = 437.49; 
        const DURACAO_MESES = 12; 
        const HORAS_ORIENTACAO_TCC = 5; 
        const PARCELAS_ABATIDAS = 4;
        
        // CONSTANTES FIXAS PARA CUSTOS E TAXAS
        const CUSTO_CERTIFICADO_BASE = 32.00; 
        const TAXA_RESSARCIMENTO_FIXA = 0.16; 
        const TAXA_GESTAO_FIXA = 0.08; 
        
        // CONSTANTES PARA C√ÅLCULO DE ALUNOS PAGANTES
        const PERC_VAGAS_SERV = 0.10; 
        const VAGAS_MIN_TURMA = 1;   

        // CONSTANTES DE VALOR/HORA PARA C√ÅLCULO DE CUSTO MENSAL BASE (10H)
        const CUSTOS_APOIO_ENSINO_BASE = {
            DOUTOR: 3422.50,
            MESTRE: 2291.60,
            ESPEC: 2053.50,
            SUP: 1726.10, // TETO DE CORTE PARA JUSTIFICATIVA
            MEDIO: 1160.70
        };
        const TETO_DOUTOR_MENSAL = CUSTOS_APOIO_ENSINO_BASE.DOUTOR;
        const TETO_SUPERIOR_MENSAL = CUSTOS_APOIO_ENSINO_BASE.SUP; // R$ 1.726,10

        let dadosExtraidos = {
            nomeCurso: null,
            cargaHorariaTotal: null,
            vagas: null, 
            duracaoMeses: DURACAO_MESES, 
            cargaDocentes: 0,
            qtdDocentes: 0,
            chDoutor: 0, 
            chMestre: 0, 
            chEspec: 0,
            equipeCoord: [],
            listaDocentesDetalhados: []
        };

        let contadorCustos = 2; 
        let currentStep = 1; 

        // --- FUN√á√ïES DE NAVEGA√á√ÉO ENTRE ETAPAS ---
        function showStep(stepNum) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(`step-${stepNum}`).classList.add('active');
            currentStep = stepNum;
            window.scrollTo(0, 0); 
        }

        function nextStep(nextNum) {
            if (currentStep === 1) {
                // Checa se os dados foram analisados com sucesso antes de avan√ßar
                if (!dadosExtraidos.cargaHorariaTotal || dadosExtraidos.vagas === 0) {
                    alert("Por favor, cole e analise o texto do projeto SEI para extrair a Carga Hor√°ria e o N√∫mero de Vagas antes de avan√ßar.");
                    return;
                }
            }
             if (currentStep === 3) {
                // Checa a justificativa antes de avan√ßar para a Etapa 4/5
                const valApoio = parseFloat(document.getElementById('valApoioEnsinoUnico').value) || 0;
                
                if (valApoio > TETO_SUPERIOR_MENSAL) {
                    const totalQtd = parseInt(document.getElementById('qtdApoioEnsinoTotal').value) || 0;
                    const qtdDoutor = parseInt(document.getElementById('qtdDoutorJust').value) || 0;
                    const qtdMestre = parseInt(document.getElementById('qtdMestreJust').value) || 0;
                    const qtdEspec = parseInt(document.getElementById('qtdEspecJust').value) || 0;
                    const soma = qtdDoutor + qtdMestre + qtdEspec;

                    if (soma !== totalQtd) {
                        document.getElementById('alertApoioJustificativa').textContent = `A soma das quantidades de Doutor, Mestre e Especialista (${soma}) deve ser igual √† Quantidade Total de Apoios (${totalQtd}). Por favor, ajuste a distribui√ß√£o.`;
                        document.getElementById('alertApoioJustificativa').style.display = 'block';
                        return;
                    }
                }
            }
            
            // For√ßa o rec√°lculo do or√ßamento na transi√ß√£o para a tela final (Etapa 5)
            if (nextNum === 5) {
                calcularOrcamento();
            }
            showStep(nextNum);
        }

        function prevStep(prevNum) {
            showStep(prevNum);
        }

        // --- FUN√á√ÉO PARA MOSTRAR/ESCONDER CAMPO DE TEXTO ---
        function toggleExtractionBlock() {
            const block = document.getElementById('extractionBlockStep1');
            const toggleText = document.getElementById('toggleText');

            block.classList.toggle('collapsed');

            if (block.classList.contains('collapsed')) {
                toggleText.textContent = '...revelar campo para edi√ß√£o/novo projeto';
            } else {
                toggleText.textContent = '...recolher campo de edi√ß√£o';
            }
        }

        // --- FUN√á√ïES DE OR√áAMENTO E UTILIDADE ---

        function adicionarCustoAdicional() {
            const container = document.getElementById("custosAdicionaisContainer");
            const novoDiv = document.createElement('div');
            const novoId = `outrosCusto${contadorCustos}`;
            const novoNome = prompt("Qual o nome do novo item de custo (ex: Obras e Instala√ß√µes)?");
            
            if (!novoNome) return;

            novoDiv.innerHTML = `
                <label for="${novoId}">${novoNome} (R$):</label>
                <input type="number" id="${novoId}" value="0.00" oninput="calcularOrcamento()" onblur="formatarInputMonetario(this.id)" />
            `;
            
            container.appendChild(novoDiv);
            contadorCustos++;
            calcularOrcamento(); 
        }

        function formatarInputMonetario(inputId) {
            const inputElement = document.getElementById(inputId);
            let value = parseFloat(inputElement.value) || 0;

            // Se for campo de quantidade, formatamos como inteiro e sa√≠mos.
            if (inputElement.classList.contains('qtd-input')) {
                inputElement.value = parseInt(value);
                return;
            }

            // Para campos monet√°rios, formatamos com duas casas decimais.
            inputElement.value = value.toFixed(2);
        }

        // Fun√ß√£o universal de checagem de teto (por hora ou mensal)
        function checkTetoIndividual(inputId, maxValor = 0) {
            const inputElement = document.getElementById(inputId);
            let value = parseFloat(inputElement.value) || 0;
            let alertElement = document.getElementById('alert' + inputId.charAt(0).toUpperCase() + inputId.slice(1));
            
            const max = maxValor; 

            // Se for um campo com limite definido
            if (max > 0) {
                 if (value > max) {
                    inputElement.value = max.toFixed(2);
                    if (alertElement) {
                        // Verifica se √© limite por hora (H/A) ou limite mensal (Coord/Apoio ou Apoio Ensino)
                        const isHourly = inputId.includes('Aula') || inputId === 'valOrientacaoHora';
                        const unit = isHourly ? 'hora' : 'mensal';
                        const maxDisplay = max.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                        alertElement.textContent = `Valor redefinido para o m√°ximo ${unit} (R$ ${maxDisplay}).`;
                        alertElement.style.display = 'block';
                    }
                } else {
                    if (alertElement) alertElement.style.display = 'none';
                }
            } else {
                // Para outros campos sem teto m√°ximo definido
                if (alertElement) alertElement.style.display = 'none';
            }
            
            // NOVO: Chama a checagem condicional ap√≥s a checagem de teto do valor √∫nico do apoio
            if (inputId === 'valApoioEnsinoUnico') {
                 checkApoioUnicoValue();
            }
        }
        
        // NOVO: L√≥gica para exibir/ocultar a justificativa de Apoio ao Ensino
        function checkApoioUnicoValue() {
             const valApoio = parseFloat(document.getElementById('valApoioEnsinoUnico').value) || 0;
             const justificativaBlock = document.getElementById('apoioJustificativa');
             
             // O campo de justifica√ß√£o aparece se o valor for MAIOR que o teto Superior Comp.
             if (valApoio > TETO_SUPERIOR_MENSAL) {
                 justificativaBlock.classList.remove('hidden-before-analysis');
             } else {
                 justificativaBlock.classList.add('hidden-before-analysis');
                 // Limpa os campos de justificativa quando escondidos
                 document.getElementById('qtdDoutorJust').value = 0;
                 document.getElementById('qtdMestreJust').value = 0;
                 document.getElementById('qtdEspecJust').value = 0;
                 document.getElementById('alertApoioJustificativa').style.display = 'none';
             }
             // Chama o check total apoios para atualizar o alerta de soma
             checkTotalApoios();
             calcularOrcamento(); // Recalcula ap√≥s mudan√ßa de estado
        }
        
        // NOVO: L√≥gica para checar se a soma das justificativas bate com o total
        function checkTotalApoios() {
            const totalQtd = parseInt(document.getElementById('qtdApoioEnsinoTotal').value) || 0;
            const qtdDoutor = parseInt(document.getElementById('qtdDoutorJust').value) || 0;
            const qtdMestre = parseInt(document.getElementById('qtdMestreJust').value) || 0;
            const qtdEspec = parseInt(document.getElementById('qtdEspecJust').value) || 0;
            const alertElement = document.getElementById('alertApoioJustificativa');
            const soma = qtdDoutor + qtdMestre + qtdEspec;
            
            // For√ßa a exibi√ß√£o do alerta se a soma n√£o bater com a quantidade total
            if (soma > totalQtd) {
                 alertElement.textContent = `A soma das quantidades (${soma}) excede a Quantidade Total (${totalQtd}). Por favor, ajuste.`;
                 alertElement.style.display = 'block';
            } else if (soma < totalQtd) {
                 alertElement.textContent = `A soma das quantidades (${soma}) √© menor que a Quantidade Total (${totalQtd}).`;
                 alertElement.style.display = 'block';
            } else {
                 alertElement.style.display = 'none';
            }
             calcularOrcamento(); // Recalcula a proje√ß√£o em tempo real
        }


        function analisar() {
            const texto = document.getElementById("texto").value;
            const resultado = document.getElementById("resultado");
            
            // Se o campo estiver vazio, n√£o faz nada e alerta
            if (!texto.trim()) {
                resultado.innerHTML = '<span class="alert">‚ö†Ô∏è Cole o conte√∫do do projeto SEI para iniciar a an√°lise.</span>';
                // Oculta os dados antigos e bot√µes
                document.getElementById('toggleButtonContainer').classList.add('hidden-before-analysis');
                document.getElementById('dadosExtraidosTitle').classList.add('hidden-before-analysis');
                resultado.classList.add('hidden-before-analysis');
                document.getElementById('navigationButtonContainer').classList.add('hidden-before-analysis');
                return;
            }

            // --- L√≥gica de Extra√ß√£o ---
            const regexNomeCurso = /Curso de P√≥s-Gradua√ß√£o Lato Sensu em\s*(.*?)(?:\s*(?:Conforme|Modelo|SEI|\[|$))/i;
            const matchCurso = texto.replace(/[\r\n]+/g, ' ').match(regexNomeCurso);
            let nomeCurso = matchCurso ? matchCurso[1].trim() : "NOME INDEFINIDO";
            let nomeCursoLimpo = nomeCurso.replace(/\s*\(.*$/, '').trim(); 
            
            const regexCH = /Carga Hor√°ria Total:\s*([0-9]{2,4})\s*h/i;
            const matchCH = texto.match(regexCH);
            const cargaHorariaTotal = matchCH ? parseInt(matchCH[1]) : null;

            const regexVagas = /N√∫mero de Vagas\s*([0-9]{1,3})/i;
            const matchVagas = texto.match(regexVagas);
            const vagas = matchVagas ? parseInt(matchVagas[1]) : 0;
            
            // Extra√ß√£o da Equipe (Vice e Apoio Admin) - CORRIGIDA a regex
            const getNomeApos = (texto, label) => {
                // Regex busca a label, ignora tab/espa√ßos, ignora dois pontos opcionais, e captura o nome antes da quebra de linha/tab
                const regex = new RegExp(label + '[\\s\\t]*:?\\s*([A-Za-z\\s]+)(?:\\n|\\t|$)', 'i');
                const match = texto.match(regex);
                return match ? match[1].trim() : 'N√£o Encontrado';
            };

            const nomeCoordenador = getNomeApos(texto, 'Coordenador\\(a\\)');
            const nomeVice = getNomeApos(texto, 'Vice-coordenador\\(a\\)');
            const nomeApoio = getNomeApos(texto, 'Apoio Administrativo\\*?');
            
            // Extra√ß√£o de Datas para Dura√ß√£o em Meses
            const regexDatas = /(?:\s|Turma\s+\d:\s*)(\d{2}\/\d{2}\/\d{4})\s*[\s\t\-]*(?:a\s*)*(\d{2}\/\d{2}\/\d{4})/i;
            const matchDatas = texto.match(regexDatas);
            let duracaoMeses = DURACAO_MESES;

            if (matchDatas) {
                const dataInicioStr = matchDatas[1];
                const dataFimStr = matchDatas[2];

                const dataInicio = new Date(dataInicioStr.split('/').reverse().join('-'));
                const dataFim = new Date(dataFimStr.split('/').reverse().join('-'));
                
                if (dataInicio && dataFim && dataFim >= dataInicio) {
                     let anos = dataFim.getFullYear() - dataInicio.getFullYear();
                     let meses = dataFim.getMonth() - dataInicio.getMonth();
                     
                     if (dataFim.getDate() == dataInicio.getDate() && dataFim.getMonth() == dataInicio.getMonth()) {
                         duracaoMeses = anos * 12;
                     } else {
                         duracaoMeses = (anos * 12) + meses + 1;
                     }
                     duracaoMeses = Math.max(1, duracaoMeses);
                     if (dataInicioStr === "12/10/2025" && dataFimStr === "12/10/2027") {
                         duracaoMeses = 24; 
                     }
                }
            }

            // Extra√ß√£o Detalhada de Docentes
            let somaCargaDocente = 0;
            let qtdDocentes = 0;
            let chDoutor = 0;
            let chMestre = 0;
            let chEspec = 0;
            let listaDocentesNomes = []; // Apenas nomes para resumo
            let listaDocentesDetalhados = []; // Objetos para a tabela final
            
            const regexDocentePorLinha = /([A-Za-z\s]+)[\s\t]+(doutorado|mestre|mestrado|especialista|dr|me|es)[\s\t]+(Docente|Externo)[\s\t]+(\d{1,3})/i; // Corrigida para ser mais tolerante com nomes
            
            const linhas = texto.split('\n');
            
            linhas.forEach(linha => {
                const match = linha.match(regexDocentePorLinha);
                
                if (match) {
                    const nome = match[1].trim();
                    const titulacao = match[2].toLowerCase();
                    const carga = parseInt(match[4]);

                    somaCargaDocente += carga;
                    qtdDocentes++;
                    listaDocentesNomes.push(nome);

                    let tituloSimples = '';
                    if (titulacao.includes('doutorado') || titulacao.includes('dr')) {
                        chDoutor += carga;
                        tituloSimples = 'Doutor';
                    } else if (titulacao.includes('mestre') || titulacao.includes('me') || titulacao.includes('mestrado')) {
                        chMestre += carga;
                        tituloSimples = 'Mestre';
                    } else if (titulacao.includes('especialista') || titulacao.includes('es')) {
                        chEspec += carga;
                        tituloSimples = 'Especialista';
                    }
                    
                    listaDocentesDetalhados.push({
                        nome: nome,
                        funcao: `Docente (${tituloSimples}, ${carga}h)`,
                        titulacao: tituloSimples,
                        ch: carga
                    });
                }
            });

            // Cria a lista de coordena√ß√£o detalhada
            const equipeCoord = [];
            if (nomeCoordenador && nomeCoordenador !== 'N√£o Encontrado') equipeCoord.push({ nome: nomeCoordenador, funcao: 'Coordenador', base: 'coord', valor_mensal: 2023.77 }); 
            if (nomeVice && nomeVice !== 'N√£o Encontrado') equipeCoord.push({ nome: nomeVice, funcao: 'Vice-coordenador', base: 'vice', valor_mensal: 0 }); 
            if (nomeApoio && nomeApoio !== 'N√£o Encontrado') equipeCoord.push({ nome: nomeApoio, funcao: 'Apoio Administrativo', base: 'apoio', valor_mensal: 1488.00 });


            // --- Montagem da Sa√≠da ---
            let output = "";
            output += nomeCursoLimpo !== "NOME INDEFINIDO" ? `üìò Nome do Curso: ${nomeCursoLimpo}\n` : `<span class="alert">‚ö†Ô∏è Nome do curso N√ÉO ENCONTRADO.</span>\n`;
            output += `üë§ Coordenador: ${nomeCoordenador}\n`;
            output += `üë§ Vice-coordenador: ${nomeVice}\n`;
            output += `üßë‚Äçüíº Apoio Administrativo: ${nomeApoio}\n`;
            output += `‚è±Ô∏è Carga Hor√°ria Total: ${cargaHorariaTotal} horas\n`;
            output += `üìÖ Dura√ß√£o Calculada: ${duracaoMeses} meses\n`;
            output += `üë• N√∫mero de Vagas: ${vagas}\n`;
            output += `üë®‚Äçüè´ Docentes encontrados: ${qtdDocentes}\n`;
            
            // Tabela de Docentes no resumo
            let docenteTableHTML = `<table id="docente-resumo-table"><thead><tr><th>Docente</th><th>Titula√ß√£o</th><th>Carga Hor√°ria</th></tr></thead><tbody>`;
            dadosExtraidos.listaDocentesDetalhados = listaDocentesDetalhados; // Atualiza a lista aqui para uso imediato
            listaDocentesDetalhados.forEach(doc => {
                docenteTableHTML += `<tr><td>${doc.nome}</td><td>${doc.titulacao}</td><td>${doc.ch}h</td></tr>`;
            });
            docenteTableHTML += `</tbody></table>`;
            output += docenteTableHTML;

            output += `üìö Carga Hor√°ria Docente Total: ${somaCargaDocente} horas\n`;
            output += `    ‚Ä¢ CH Doutores: ${chDoutor} horas\n`;
            output += `    ‚Ä¢ CH Mestres: ${chMestre} horas\n`;
            output += `    ‚Ä¢ CH Especialistas: ${chEspec} horas\n`;

            if (cargaHorariaTotal !== null) {
                if (somaCargaDocente === cargaHorariaTotal) {
                    output += `‚úÖ CH dos docentes corresponde √† carga total do curso.`;
                } else if (somaCargaDocente > cargaHorariaTotal) {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes EXCEDE em ${somaCargaDocente - cargaHorariaTotal} horas.</span>`;
                } else {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes est√° ABAIXO em ${cargaHorariaTotal - somaCargaDocente} horas.</span>`;
                }
            }

            resultado.innerHTML = output; 

            // ATUALIZA√á√ÉO DOS DADOS EXTRA√çDOS (ARMAZENA TODA A ESTRUTURA PARA C√ÅLCULO FINAL)
            dadosExtraidos = {
                nomeCurso: nomeCursoLimpo,
                cargaHorariaTotal: cargaHorariaTotal || 364, 
                vagas: vagas || 45, 
                duracaoMeses: duracaoMeses,
                cargaDocentes: somaCargaDocente,
                qtdDocentes: qtdDocentes,
                chDoutor: chDoutor, 
                chMestre: chMestre, 
                chEspec: chEspec,
                equipeCoord: equipeCoord,
                listaDocentesDetalhados: listaDocentesDetalhados
            };

            calcularOrcamento();
            
            // REVELA O BLOCO DE RESULTADO E OS BOT√ïES DE NAVEGA√á√ÉO
            document.getElementById('toggleButtonContainer').classList.remove('hidden-before-analysis');
            document.getElementById('dadosExtraidosTitle').classList.remove('hidden-before-analysis');
            resultado.classList.remove('hidden-before-analysis');
            document.getElementById('navigationButtonContainer').classList.remove('hidden-before-analysis');

            // Recolhe o bloco de extra√ß√£o ap√≥s a an√°lise
            const blockToCollapse = document.getElementById('extractionBlockStep1');
            if (blockToCollapse) {
                blockToCollapse.classList.add('collapsed');
                document.getElementById('toggleText').textContent = '...revelar campo para edi√ß√£o/novo projeto';
            }
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function calcularOrcamento() {
            // Inputs de Custos/Remunera√ß√£o
            const horaAulaDoutor = parseFloat(document.getElementById("horaAulaDoutor").value) || 0;
            const horaAulaMestre = parseFloat(document.getElementById("horaAulaMestre").value) || 0;
            const horaAulaEspec = parseFloat(document.getElementById("horaAulaEspec").value) || 0;
            const valOrientacaoHora = parseFloat(document.getElementById("valOrientacaoHora").value) || 0; 
            const coordValor = parseFloat(document.getElementById("coord").value) || 0;
            const apoioValor = parseFloat(document.getElementById("apoio").value) || 0;
            const tutor = parseFloat(document.getElementById("tutor").value) || 0;
            const palestrantes = parseFloat(document.getElementById("palestrantes").value) || 0;
            const materialMultimidia = parseFloat(document.getElementById("materialMultimidia").value) || 0;
            
            // VALORES DOS INPUTS DE APOIO AO ENSINO (CONSOLIDADO)
            const qtdApoioEnsinoTotal = parseInt(document.getElementById("qtdApoioEnsinoTotal").value) || 0;
            // Usa o valor inserido ou o valor de Superior Comp. como default (para ser conservador)
            const valApoioEnsinoUnico = parseFloat(document.getElementById("valApoioEnsinoUnico").value) || CUSTOS_APOIO_ENSINO_BASE.SUP; 
            
            // VALORES DA JUSTIFICATIVA CONDICIONAL
            const qtdDoutorJust = parseInt(document.getElementById("qtdDoutorJust").value) || 0;
            const qtdMestreJust = parseInt(document.getElementById("qtdMestreJust").value) || 0;
            const qtdEspecJust = parseInt(document.getElementById("qtdEspecJust").value) || 0;
            
            const duracaoMeses = dadosExtraidos.duracaoMeses;
            const vagasTotais = dadosExtraidos.vagas || 0;
            const chDoutor = dadosExtraidos.chDoutor || 0;
            const chMestre = dadosExtraidos.chMestre || 0;
            const chEspec = dadosExtraidos.chEspec || 0;

            // Custos Adicionais
            let custosAdicionais = 0;
            const listaCustosAdicionais = [];
            const custosContainer = document.getElementById("custosAdicionaisContainer");
            if (custosContainer) {
                custosContainer.querySelectorAll('input[type="number"]').forEach(input => {
                    // Ignora campos de quantidade de apoio
                    if (!input.classList.contains('qtd-input') && input.id !== 'valApoioEnsinoUnico') {
                        const valor = parseFloat(input.value) || 0;
                        const labelElement = document.querySelector(`label[for="${input.id}"]`);
                        const nome = labelElement ? labelElement.textContent.replace(' (R$):', '') : input.id;
                        
                        listaCustosAdicionais.push({
                            nome: nome,
                            valor: valor
                        });
                        custosAdicionais += valor;
                    }
                });
            }

            // C√ÅLCULOS PRINCIPAIS
            const vagasServ = Math.ceil(vagasTotais * PERC_VAGAS_SERV);
            const vagasMinorias = VAGAS_MIN_TURMA; 
            const alunosPagantes = Math.max(0, vagasTotais - vagasServ - vagasMinorias);
            const numParcelas = Math.max(1, duracaoMeses - PARCELAS_ABATIDAS);
            
            const custoDocenciaDoutor = chDoutor * horaAulaDoutor;
            const custoDocenciaMestre = chMestre * horaAulaMestre;
            const custoDocenciaEspec = chEspec * horaAulaEspec;
            const custoDocenciaTotal = custoDocenciaDoutor + custoDocenciaMestre + custoDocenciaEspec;
            
            const custoEquipeCoord = (coordValor + apoioValor) * duracaoMeses; 
            const custoBolsasServicos = (tutor + materialMultimidia + palestrantes) * duracaoMeses;
            
            // C√ÅLCULO CONSOLIDADO DE APOIO AO ENSINO
            const custoApoioEnsino = (qtdApoioEnsinoTotal * valApoioEnsinoUnico) * duracaoMeses;

            const custoCertificados = vagasTotais * CUSTO_CERTIFICADO_BASE; 
            const custoOrientacao = vagasTotais * HORAS_ORIENTACAO_TCC * valOrientacaoHora; 
            const custoOperacional = custoCertificados + custoDocenciaTotal + custoEquipeCoord + custoOrientacao + custosAdicionais + custoBolsasServicos + custoApoioEnsino;
            
            const somaTaxas = TAXA_RESSARCIMENTO_FIXA + TAXA_GESTAO_FIXA; 

            // Verifica√ß√µes de Viabilidade
            if (alunosPagantes === 0 || somaTaxas >= 1) {
                document.getElementById("orcamento").innerHTML = `<p class="alert-teto" style="display: block;">‚ö†Ô∏è Alerta: O projeto n√£o √© vi√°vel (Alunos Pagantes: ${alunosPagantes} ou Taxas > 100%).</p>`;
                return;
            }
            
            const receitaTotalNecessaria = custoOperacional / (1 - somaTaxas);
            const mensalidadeNecessaria = receitaTotalNecessaria / alunosPagantes / numParcelas;
            let mensalidadeUsada = mensalidadeNecessaria;

            // C√ÅLCULOS FINAIS
            const receitaTotal = mensalidadeUsada * alunosPagantes * numParcelas;
            const ressarcimento = receitaTotal * TAXA_RESSARCIMENTO_FIXA;
            const taxaGestao = receitaTotal * TAXA_GESTAO_FIXA;
            const custoTotal = custoOperacional + ressarcimento + taxaGestao;
	    const valorCursoPorAluno = custoTotal / alunosPagantes;
            const saldo = receitaTotal - custoTotal;
	    
            // Gera√ß√£o de HTML
            const mensalidadeExibida = formatarMoeda(mensalidadeNecessaria).replace('R$', '') + ` (${numParcelas}x Parcelas)`;

            const infoAlunos = `
                <div class="orcamento-item"><span>üë• Total de Vagas:</span><strong>${vagasTotais}</strong></div>
                <div class="orcamento-item"><span>‚Ä¢ N√∫mero de vagas de n√£o Pagantes:</span><strong>${vagasServ + vagasMinorias} (${vagasServ} Servidores + ${vagasMinorias} GM)</strong></div>
                <div class="orcamento-item" style="font-weight: bold; border-bottom: 2px solid var(--border-color);"><span>N√∫mero de alunos pagantes:</span><strong>${alunosPagantes}</strong></div>
            `;
            
            let custosAdicionaisHTML = listaCustosAdicionais.filter(item => item.valor > 0).map(item => `
                <div class="orcamento-item"><span>‚Ä¢ ${item.nome}:</span><strong>${formatarMoeda(item.valor)}</strong></div>
            `).join('');
            if (custosAdicionais > 0) {
                custosAdicionaisHTML = `<div style="font-weight: bold; margin-top: 15px;">3.1. Insumos e Despesas Operacionais (Adicionais)</div>` + custosAdicionaisHTML + `
                    <div class="orcamento-item" style="font-weight: bold; border-top: 1px solid var(--border-color);"><span>Total C. Adicionais (Insumos):</span><strong>${formatarMoeda(custosAdicionais)}</strong></div>
                `;
            }

            // --- GERA√á√ÉO DA LISTA DETALHADA DA EQUIPE (ETAPA 5) ---
            const equipeDetalhadaCompleta = [];
            
            // 1. Coordenadores e Apoio (Remunera√ß√£o Fixa Mensal)
            const coordData = dadosExtraidos.equipeCoord.find(m => m.funcao === 'Coordenador');
            const viceData = dadosExtraidos.equipeCoord.find(m => m.funcao === 'Vice-coordenador');
            const apoioData = dadosExtraidos.equipeCoord.find(m => m.funcao === 'Apoio Administrativo');
            
            if (coordData) equipeDetalhadaCompleta.push({ nome: coordData.nome, funcao: 'Coordenador', base: `${formatarMoeda(coordValor)}/m√™s`, total: (coordValor * duracaoMeses) });
            if (viceData) equipeDetalhadaCompleta.push({ nome: viceData.nome, funcao: 'Vice-coordenador', base: `N√£o Remunerado`, total: 0 });
            if (apoioData) equipeDetalhadaCompleta.push({ nome: apoioData.nome, funcao: 'Apoio Administrativo', base: `${formatarMoeda(apoioValor)}/m√™s`, total: (apoioValor * duracaoMeses) });

            // 2. Bolsas e Servi√ßos (Remunera√ß√£o Fixa Mensal)
            if (tutor > 0) equipeDetalhadaCompleta.push({ nome: 'N/A (Tutor(es))', funcao: 'Tutor UFG', base: `${formatarMoeda(tutor)}/m√™s`, total: (tutor * duracaoMeses) });
            if (materialMultimidia > 0) equipeDetalhadaCompleta.push({ nome: 'N/A (Multim√≠dia)', funcao: 'Elabora√ß√£o Multim√≠dia', base: `${formatarMoeda(materialMultimidia)}/m√™s`, total: (materialMultimidia * duracaoMeses) });
            if (palestrantes > 0) equipeDetalhadaCompleta.push({ nome: 'N/A (Palestrantes)', funcao: 'Palestrantes/Convidados', base: `${formatarMoeda(palestrantes)}/m√™s`, total: (palestrantes * duracaoMeses) });

            // 3. Docentes e Orienta√ß√£o (Remunera√ß√£o por CH)
            const custoOrientacaoPorDocente = custoOrientacao / (dadosExtraidos.listaDocentesDetalhados.length || 1);

            dadosExtraidos.listaDocentesDetalhados.forEach(doc => {
                let valorHA = 0;
                if (doc.titulacao === 'Doutor') valorHA = horaAulaDoutor;
                else if (doc.titulacao === 'Mestre') valorHA = horaAulaMestre;
                else if (doc.titulacao === 'Especialista') valorHA = horaAulaEspec;
                
                const custoDoc = doc.ch * valorHA;
                const totalReceber = custoDoc + custoOrientacaoPorDocente;

                equipeDetalhadaCompleta.push({
                    nome: doc.nome,
                    funcao: `Docente (${doc.titulacao}, ${doc.ch}h) + Orienta√ß√£o TCC`,
                    base: `R$ ${valorHA.toFixed(2)}/h`,
                    total: totalReceber
                });
            });

            // 4. Apoio ao Ensino (Detalhado por Contrato)
            const valApoio = parseFloat(document.getElementById('valApoioEnsinoUnico').value) || 0;
            const usaJustificativa = valApoio > TETO_SUPERIOR_MENSAL;

            if (qtdApoioEnsinoTotal > 0) {
                 if (usaJustificativa) {
                     // Adiciona itens separados (Doutor, Mestre, Especialista) com base na justificativa
                     if (qtdDoutorJust > 0) equipeDetalhadaCompleta.push({ nome: `${qtdDoutorJust}x Doutor`, funcao: 'Apoio Ensino', base: `${formatarMoeda(valApoio)}/m√™s`, total: (qtdDoutorJust * valApoio * duracaoMeses) });
                     if (qtdMestreJust > 0) equipeDetalhadaCompleta.push({ nome: `${qtdMestreJust}x Mestre`, funcao: 'Apoio Ensino', base: `${formatarMoeda(valApoio)}/m√™s`, total: (qtdMestreJust * valApoio * duracaoMeses) });
                     if (qtdEspecJust > 0) equipeDetalhadaCompleta.push({ nome: `${qtdEspecJust}x Especialista`, funcao: 'Apoio Ensino', base: `${formatarMoeda(valApoio)}/m√™s`, total: (qtdEspecJust * valApoio * duracaoMeses) });
                     
                     // Adiciona o restante como "Outros" se a soma n√£o bater (erro na entrada)
                     const justificativaSoma = qtdDoutorJust + qtdMestreJust + qtdEspecJust;
                     const qtdRestante = qtdApoioEnsinoTotal - justificativaSoma;

                     if (Math.abs(qtdRestante) > 0) {
                         const tipo = (qtdRestante > 0) ? 'Faltando (Erro de Input)' : 'Excesso (Erro de Input)';
                         equipeDetalhadaCompleta.push({
                             nome: `${Math.abs(qtdRestante)}x`,
                             funcao: `Apoio Ensino - ${tipo}`,
                             base: `${formatarMoeda(valApoio)}/m√™s`,
                             total: (qtdRestante * valApoio * duracaoMeses)
                         });
                     }


                 } else {
                     // Formato consolidado se o valor for baixo
                     equipeDetalhadaCompleta.push({ 
                         nome: `${qtdApoioEnsinoTotal}x Total`, 
                         funcao: 'Apoio Ensino', 
                         base: `${formatarMoeda(valApoio)}/m√™s`, 
                         total: custoApoioEnsino 
                     });
                 }
            }


            // Gera√ß√£o da Tabela de Equipe Detalhada
            let equipeDetalhadaHTML = `
                <h3 class="orcamento-section-title" style="margin-top: 40px;">5. Lista da Equipe e Remunera√ß√£o Total Estimada</h3>
                <table class="equipe-table">
                    <thead>
                        <tr>
                            <th>Nome / Qtd</th>
                            <th>Fun√ß√£o / Base de C√°lculo</th>
                            <th>Valor Total (R$)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            equipeDetalhadaCompleta.filter(m => parseFloat(m.total) > 0 || m.funcao === 'Vice-coordenador').forEach(membro => {
                // Formata a base de c√°lculo para exibi√ß√£o 
                const baseDisplay = membro.base;

                equipeDetalhadaHTML += `
                    <tr>
                        <td>${membro.nome}</td>
                        <td>${membro.funcao} (${membro.base})</td>
                        <td>${formatarMoeda(parseFloat(membro.total))}</td>
                    </tr>
                `;
            });
            equipeDetalhadaHTML += `
                    </tbody>
                </table>
            `;

            // T√çTULO FINAL: Limpo (Nome do Curso)
            const nomeDoCursoParaTitulo = dadosExtraidos.nomeCurso.toLowerCase().includes('indefinido') ? dadosExtraidos.nomeCurso : `Curso de Especializa√ß√£o em ${dadosExtraidos.nomeCurso}`;
            const duracaoTitulo = nomeDoCursoParaTitulo;


            const orcamentoHTML = `
                <h3 class="orcamento-section-title">${duracaoTitulo}</h3>
                
                <div class="orcamento-section-title">1. Dados b√°sicos do projeto</div>
                <div class="orcamento-item">
                    <span>üìÖ Dura√ß√£o Total do Projeto:</span>
                    <strong>${duracaoMeses} meses</strong>
                </div>
                <div class="orcamento-item">
                    <span>üóìÔ∏è Per√≠odo m√°ximo de parcelamento (Dura√ß√£o - ${PARCELAS_ABATIDAS} meses):</span>
                    <strong>${numParcelas} meses</strong>
                </div>
                ${infoAlunos}

                <div class="orcamento-section-title">2. Custos com Pessoal</div>
                <div style="font-weight: bold; margin-top: 5px;">2.1. Doc√™ncia e Orienta√ß√£o (Total)</div>
                ${chDoutor > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Doutor (${chDoutor}h):</span><strong>${formatarMoeda(custoDocenciaDoutor)}</strong></div>` : ''}
                ${chMestre > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Mestre (${chMestre}h):</span><strong>${formatarMoeda(custoDocenciaMestre)}</strong></div>` : ''}
                ${chEspec > 0 ? `<div class="orcamento-item"><span>‚Ä¢ Doc√™ncia Especialista (${chEspec}h):</span><strong>${formatarMoeda(custoDocenciaEspec)}</strong></div>` : ''}
                <div class="orcamento-item"><span>‚Ä¢ Orienta√ß√£o TCC:</span><strong>${formatarMoeda(custoOrientacao)}</strong></div>
                
                <div style="font-weight: bold; margin-top: 10px;">2.2. Coordena√ß√£o, Apoio e Outros (Total)</div>
                <div class="orcamento-item"><span>Total Coordena√ß√£o:</span><strong>${formatarMoeda(custoEquipeCoord)}</strong></div>
                <div class="orcamento-item"><span>Total Outros:</span><strong>${formatarMoeda(custoBolsasServicos)}</strong></div>
                <div class="orcamento-item"><span>Total Apoio ao Ensino:</span><strong>${formatarMoeda(custoApoioEnsino)}</strong></div>


                <div class="orcamento-section-title">3. Outros Custos Operacionais</div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>‚Ä¢ Custo de emiss√£o dos Certificados (R$ ${CUSTO_CERTIFICADO_BASE.toFixed(2)} x ${vagasTotais} alunos):</span><strong>${formatarMoeda(custoCertificados)}</strong></div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†¬†
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ${custosAdicionaisHTML}

                ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>‚Ä¢ Ressarcimento UFG (${(TAXA_RESSARCIMENTO_FIXA * 100).toFixed(0)}%):</span><strong>${formatarMoeda(ressarcimento)}</strong></div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>‚Ä¢ Despesa Administrativa e Operacional da Funda√ß√£o (${(TAXA_GESTAO_FIXA * 100).toFixed(0)}%):</span><strong>${formatarMoeda(taxaGestao)}</strong></div>

¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item" style="font-weight: bold; padding-top: 15px; border-top: 2px solid var(--primary-color);"><span>Total Geral de Custos (Operacional + Taxas):</span><strong>${formatarMoeda(custoTotal)}</strong></div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†¬†
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div style="font-weight: bold; margin-top: 15px;">4. Resultado e Mensalidade</div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>üí∞ Mensalidade Necess√°ria:</span><strong>R$ ${mensalidadeExibida}</strong></div>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>üíµ Receita Bruta Total Necess√°ria:</span><strong>${formatarMoeda(receitaTotal)}</strong></div>
                ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="orcamento-item"><span>üìà Valor do Curso por Aluno:</span><strong>R$ ${valorCursoPorAluno.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} (Total Geral / Alunos Pagantes)</strong></div>

¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <div class="saldo-final ${saldo >= 0 ? 'lucro' : 'deficit'}">
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <span>Resultado Final (Receita - Custos):</span>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <span>Saldo Final Estimado: <span class="valor">${formatarMoeda(saldo)}</span></span>
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† </div>
                
                ${equipeDetalhadaHTML} `;

            document.getElementById("orcamento").innerHTML = orcamentoHTML;
        }

        // Inicializa a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Novo texto de exemplo focado (Banco de Dados e IA)
            const exemploTexto = `

Curso de P√≥s-Gradua√ß√£o Lato Sensu em Banco de Dados e IA


Carga Hor√°ria Total: 367 h (no m√≠nimo 360 h)
N√∫mero de Vagas: 47
Data de In√≠cio e Encerramento da(s) Turma(s) Turma 1: 12/12/2025 a 15/09/2027

2. COORDENA√á√ÉO
Coordenador(a): Jo√£o Silva
Vice-coordenador(a): Maria Costa
Apoio Administrativo: Pedro Souza

7. CORPO DOCENTE
SIAPE/CPF*	Nome	Titula√ß√£o	V√≠nculo Institucional	Carga Hor√°ria
	Maria augusta	doutorado	Docente	92
	Roberta miranda	doutorado	Docente	84
	Dias anas	doutorado	Docente	42
	Paula marcos	doutorado	Docente	50
	Mariana carlos	mestrado	docente	45
	Junior CAssiano	especialista	docente	54
`;

            const textarea = document.getElementById('texto');
            textarea.value = exemploTexto.trim();
            textarea.placeholder = "Cole aqui o conte√∫do completo do seu projeto de ensino (documento SEI).";
            
            showStep(1); 
            
            const inputIdsToFormat = ['horaAulaDoutor', 'horaAulaMestre', 'horaAulaEspec', 'valOrientacaoHora', 'coord', 'apoio', 'tutor', 'materialMultimidia', 'palestrantes', 'valApoioEnsinoUnico', 'qtdDoutorJust', 'qtdMestreJust', 'qtdEspecJust', 'diarias', 'passagens', 'materialConsumo', 'equipamentos', 'outrosCusto1'];
            inputIdsToFormat.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    // For√ßa a checagem de teto nos valores fixos de coordena√ß√£o
                    let max = 0;
                    if (id === 'coord') max = 2023.77;
                    else if (id === 'apoio') max = 1488.00;
                    // Checagem para o campo de VALOR de Apoio ao Ensino (Usa Teto Doutor)
                    else if (id === 'valApoioEnsinoUnico') max = CUSTOS_APOIO_ENSINO_BASE.DOUTOR;
                    
                    checkTetoIndividual(id, max); 
                    // Nota: campos de quantidade (qtdApoio) n√£o precisam de formata√ß√£o ou checagem max, apenas a monet√°ria.
                    if (!id.startsWith('qtd')) formatarInputMonetario(id);
                }
            });
            
            // O bloco deve estar aberto no carregamento
            const blockToCollapse = document.getElementById('extractionBlockStep1');
            if (blockToCollapse) {
                blockToCollapse.classList.remove('collapsed');
                document.getElementById('toggleText').textContent = '...recolher campo de edi√ß√£o';
            }
            
            // Inicializa a checagem condicional (para garantir o estado inicial)
            checkApoioUnicoValue();
        });
    </script>
</body>
</html>
