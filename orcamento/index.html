<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Or√ßamento de Curso Lato Sensu</title>
    
    <style>
        /* ==================== */
        /* VARI√ÅVEIS DE CORES (TEMA: PRPG UFG - VERDE/BRANCO) */
        /* ==================== */
        :root {
            --primary-color: #38761D; /* Verde principal UFG */
            --secondary-color: #FFFFFF;
            --text-color: #333333;
            --heading-color: #1D543B; /* Verde escuro para t√≠tulos */
            --bg-neutral: #F7F7F7;
            --border-color: #CCCCCC;
            --alert-color: #D9534F; /* Vermelho para alerta/d√©ficit */
            --success-color: #4CAF50; /* Verde de sucesso/lucro */
            --highlight-bg: #E6F3E6; /* Fundo de destaque suave */
        }

        body {
            font-family: 'Arial', sans-serif;
            padding: 0;
            background: var(--bg-neutral);
            color: var(--text-color);
            margin: 0;
            line-height: 1.6;
        }

        .container {
            width: 95%;
            max-width: 1100px;
            margin: 40px auto;
            padding: 30px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* --- T√çTULO PRINCIPAL --- */
        h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        /* --- T√çTULOS DE SE√á√ÉO --- */
        h2 {
            margin-top: 40px;
            color: var(--heading-color);
            font-size: 1.6em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        /* --- BLOCO DE EXTRA√á√ÉO (SE√á√ÉO 1) --- */
        .extraction-block {
            background: var(--highlight-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            max-height: 500px; 
            overflow: hidden;
            transition: all 0.5s ease-out;
        }
        /* Classe para fechar o bloco */
        .extraction-block.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            border: 1px solid transparent;
            margin-bottom: 0;
        }


        textarea {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            min-height: 150px;
        }
        
        button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 12px 25px;
            margin-top: 15px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: var(--heading-color);
        }

        /* --- RESULTADOS DE EXTRA√á√ÉO GERAL --- */
        #resultado {
            margin-top: 20px;
            background: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            white-space: pre-wrap; 
            font-family: monospace;
            font-size: 1em;
            color: var(--text-color);
        }
        
        /* --- RESUMO GERENCIAL (Mantido para consist√™ncia, mas escondido) --- */
        #resumoGerencial {
            display: none; 
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-neutral);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            font-size: 0.95em;
        }
        #resumoGerencial div {
            padding: 10px;
            border-left: 3px solid var(--primary-color);
            background: var(--secondary-color);
            border-radius: 4px;
        }
        #resumoGerencial .alert-data { border-left: 3px solid var(--alert-color); }
        #resumoGerencial strong { display: block; font-size: 1.2em; color: var(--heading-color); }


        /* --- INPUTS DE C√ÅLCULO (SE√á√ÉO 2) --- */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        label {
            font-weight: 500;
            display: block;
            margin-top: 5px;
            color: var(--heading-color);
        }
        
        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: border-color 0.2s;
        }
        input[type="number"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        /* NOVO: Alerta de Teto Individual nos Inputs */
        .alert-input {
            color: var(--alert-color);
            font-size: 0.8em;
            margin-top: 4px;
            display: none;
        }

        /* --- RESULTADOS OR√áAMENT√ÅRIOS (SE√á√ÉO 3) --- */
        #orcamento {
            margin-top: 30px;
            padding: 25px;
            border-radius: 8px;
            border: 3px solid var(--heading-color); 
        }
        
        .orcamento-section-title {
            color: var(--primary-color);
            font-size: 1.4em;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .orcamento-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #ccc;
        }
        
        .orcamento-item span:first-child {
            font-weight: 500;
        }
        
        .orcamento-item strong {
            color: var(--heading-color);
        }

        /* Destaque do Saldo Final */
        .saldo-final {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
            font-size: 1.4em;
            display: flex;
            justify-content: space-between;
        }
        .saldo-final .valor {
            font-weight: bold;
        }
        .saldo-final.lucro .valor {
            color: var(--success-color);
        }
        .saldo-final.deficit .valor {
            color: var(--alert-color);
        }

        /* Alerta de Teto Salarial Geral */
        .alert-teto {
            color: var(--alert-color);
            font-weight: bold;
            padding: 10px;
            background-color: #ffe8e6;
            border-left: 4px solid var(--alert-color);
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            display: none; 
        }
        
        /* Informa√ß√µes Legais (Vagas) */
        .vagas-info {
            padding: 10px 15px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--highlight-bg);
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Or√ßamento de Curso Lato Sensu (UFG)</h1>

        <h2 onclick="toggleCollapse()" style="cursor: pointer;">
            1Ô∏è‚É£ Cole o conte√∫do do Projeto SEI 
            <span id="collapseIndicator" style="float: right; transition: transform 0.3s;">‚ñº</span>
        </h2>
        <div class="extraction-block" id="extractionBlock">
            <textarea id="texto" rows="10" placeholder="Cole aqui o conte√∫do do projeto SEI..."></textarea>
            <button onclick="analisarAndCollapse()">Analisar</button>
        </div>
        
        <div id="resultado">Aguardando an√°lise do projeto...</div>

        <h2>2Ô∏è‚É£ Defini√ß√£o Financeira (Custos Vari√°veis)</h2>
        
        <h3 class="orcamento-section-title">Custos por Hora/Aula e Orienta√ß√£o</h3>
        <div class="input-grid">
            <div>
                <label for="horaAulaDoutor">üë®‚Äçüè´ Valor H/A - Doutor (R$):</label>
                <input type="number" id="horaAulaDoutor" value="437.49" oninput="checkTetoIndividual('horaAulaDoutor'); calcularOrcamento();" />
                <p id="alertHoraAulaDoutor" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
            </div>
            <div>
                <label for="horaAulaMestre">üë®‚Äçüè´ Valor H/A - Mestre (R$):</label>
                <input type="number" id="horaAulaMestre" value="380.00" oninput="checkTetoIndividual('horaAulaMestre'); calcularOrcamento();" />
                <p id="alertHoraAulaMestre" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
            </div>
            <div>
                <label for="horaAulaEspec">üë®‚Äçüè´ Valor H/A - Espec. (R$):</label>
                <input type="number" id="horaAulaEspec" value="300.00" oninput="checkTetoIndividual('horaAulaEspec'); calcularOrcamento();" />
                <p id="alertHoraAulaEspec" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
            </div>
            <div>
                <label for="valOrientacaoHora">üìù Valor Orienta√ß√£o TCC (R$ / hora):</label>
                <input type="number" id="valOrientacaoHora" value="437.49" oninput="checkTetoIndividual('valOrientacaoHora'); calcularOrcamento();" />
                <p id="alertValOrientacaoHora" class="alert-input">Valor excede o limite m√°ximo por hora (R$ 437,49).</p>
            </div>
        </div>

        <h3 class="orcamento-section-title" style="margin-top: 30px;">Remunera√ß√£o Mensal da Equipe (Valor Bruto)</h3>
        
        <div class="input-grid">
            <div>
                <label for="coord">Coordenador (R$):</label>
                <input type="number" id="coord" value="2000" oninput="checkTetoIndividual('coord'); calcularOrcamento();" />
                <p id="alertCoord" class="alert-input"></p> 
            </div>
            <div>
                <label for="vice">Vice-Coordenador (R$):</label>
                <input type="number" id="vice" value="1000" oninput="checkTetoIndividual('vice'); calcularOrcamento();" />
                <p id="alertVice" class="alert-input"></p> 
            </div>
            <div>
                <label for="apoio">Apoio Administrativo (R$):</label>
                <input type="number" id="apoio" value="1500" oninput="checkTetoIndividual('apoio'); calcularOrcamento();" />
                <p id="alertApoio" class="alert-input"></p> 
            </div>
            <div>
                <label for="tutor">Tutor (R$):</label>
                <input type="number" id="tutor" value="0" oninput="checkTetoIndividual('tutor'); calcularOrcamento();" />
                <p id="alertTutor" class="alert-input"></p> 
            </div>
        </div>

        <h3 class="orcamento-section-title" style="margin-top: 30px;">3Ô∏è‚É£ Custos Fixos e Reservas Legais</h3>
        <div class="input-grid">
            <div>
                <p>Custo por Certificado (R$): **R$ 32,00 (Fixo)**</p>
                <p>Taxas Fixas:<br>
                Ressarcimento UFG: **16%** | Taxa de Gest√£o Funda√ß√£o: **8%**</p>
            </div>
        </div>
        

        <h3 class="orcamento-section-title" style="margin-top: 30px;">4Ô∏è‚É£ Custos Adicionais e Insumos (Opcional)</h3>

        <div class="input-grid" id="custosAdicionaisContainer">
            <div>
                <label for="diarias">Di√°rias e Hospedagem (R$):</label>
                <input type="number" id="diarias" value="0" oninput="calcularOrcamento()" />
            </div>
            <div>
                <label for="passagens">Passagens e Locomo√ß√£o (R$):</label>
                <input type="number" id="passagens" value="0" oninput="calcularOrcamento()" />
            </div>
            <div>
                <label for="materialConsumo">Material de Consumo (R$):</label>
                <input type="number" id="materialConsumo" value="0" oninput="calcularOrcamento()" />
            </div>
            <div>
                <label for="equipamentos">Equipamentos e Material Permanente (R$):</label>
                <input type="number" id="equipamentos" value="0" oninput="calcularOrcamento()" />
            </div>
            <div>
                <label for="outrosCusto1">Outro Custo Personalizado 1 (R$):</label>
                <input type="number" id="outrosCusto1" value="0" oninput="calcularOrcamento()" />
            </div>
        </div>

        <button onclick="adicionarCustoAdicional()">‚ûï Adicionar Outro Custo</button>


        <h3 class="orcamento-section-title" style="margin-top: 30px;">5Ô∏è‚É£ Defini√ß√£o de Receita (Valor Necess√°rio)</h3>
        <div class="input-grid">
              <div>
                <label for="mensalidade">üí∞ Valor da Mensalidade (R$):</label>
                <input type="number" id="mensalidadeNecessaria" value="500" oninput="calcularOrcamento()" />
                <small><em>O valor ser√° reajustado no c√°lculo para cobrir o custo total.</em></small>
            </div>
        </div>


        <div id="orcamento">Aguardando c√°lculo...</div>
    </div>

    <script>
        // CONSTANTES GLOBAIS
        const TETO_GERAL_BRUTO = 29760.95; 
        const MAX_HR_VALUE = 437.49; 
        const DURACAO_MESES = 12; 
        const HORAS_ORIENTACAO_TCC = 20; 
        const FTE_MONTHLY_HOURS = 160; 
        
        // NOVAS CONSTANTES FIXAS PARA CUSTOS E TAXAS
        const CUSTO_CERTIFICADO_BASE = 32.00; // Valor fixo
        const TAXA_RESSARCIMENTO_FIXA = 0.16; // 16%
        const TAXA_GESTAO_FIXA = 0.08;       // 8%
        
        // CONSTANTES PARA C√ÅLCULO DE ALUNOS PAGANTES
        const PERC_VAGAS_SERV = 0.10; // 10%
        const VAGAS_MIN_TURMA = 1;    // 1 Vaga Minorias (assumindo 1 turma)


        let dadosExtraidos = {
            nomeCurso: null,
            cargaHorariaTotal: null,
            vagas: null, // Total de Vagas
            cargaDocentes: 0,
            qtdDocentes: 0,
            chDoutor: 0, 
            chMestre: 0, 
            chEspec: 0 
        };

        // Contador para inputs personalizados
        let contadorCustos = 2; 

        // Fun√ß√£o para adicionar inputs din√¢micos
        function adicionarCustoAdicional() {
            const container = document.getElementById("custosAdicionaisContainer");
            
            const novoDiv = document.createElement('div');
            
            const novoId = `outrosCusto${contadorCustos}`;
            const novoNome = prompt("Qual o nome do novo item de custo (ex: Obras e Instala√ß√µes)?");
            
            if (!novoNome) return;

            novoDiv.innerHTML = `
                <label for="${novoId}">${novoNome} (R$):</label>
                <input type="number" id="${novoId}" value="0" oninput="calcularOrcamento()" />
            `;
            
            container.appendChild(novoDiv);
            contadorCustos++;
            calcularOrcamento(); 
        }


        // Fun√ß√£o para verificar o teto individual (s√≥ checa limite por hora)
        function checkTetoIndividual(inputId) {
            const inputElement = document.getElementById(inputId);
            const value = parseFloat(inputElement.value) || 0;
            let exceedsTeto = false;
            let alertElement = document.getElementById('alert' + inputId.charAt(0).toUpperCase() + inputId.slice(1));
            const maxHr = MAX_HR_VALUE;

            // Checagem de H/A (MANTIDA)
            if (inputId.startsWith('horaAula') || inputId === 'valOrientacaoHora') {
                if (value > maxHr) {
                    exceedsTeto = true;
                    if (alertElement) alertElement.textContent = `Valor excede o limite m√°ximo por hora (R$ ${maxHr.toFixed(2)}).`;
                } else {
                    if (alertElement) alertElement.style.display = 'none';
                }
            } else {
                // Checagem de Remunera√ß√£o Mensal (Coordena√ß√£o/Apoio) - REMOVIDA
                if (alertElement) alertElement.style.display = 'none';
            }
            
            if (exceedsTeto && alertElement) {
                alertElement.style.display = 'block';
            }
        }


        // Fun√ß√µes de UI
        function toggleCollapse() {
            const block = document.getElementById('extractionBlock');
            const indicator = document.getElementById('collapseIndicator');
            block.classList.toggle('collapsed');
            indicator.style.transform = block.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';
        }
        
        function analisarAndCollapse() {
            analisar();
            if (dadosExtraidos.vagas > 0 && dadosExtraidos.cargaHorariaTotal !== null) {
                const block = document.getElementById('extractionBlock');
                if (!block.classList.contains('collapsed')) {
                    toggleCollapse();
                }
            }
        }

        // Fun√ß√£o de An√°lise e Extra√ß√£o do Projeto SEI 
        function analisar() {
            const texto = document.getElementById("texto").value;
            const resultado = document.getElementById("resultado");

            const regexNomeCurso = /Curso de P√≥s-Gradua√ß√£o Lato Sensu em\s*(.*?)\n/i;
            const matchCurso = texto.match(regexNomeCurso);
            let nomeCurso = matchCurso ? matchCurso[1].trim() : null;
            if (!nomeCurso || nomeCurso.includes("[") || nomeCurso.toLowerCase().includes("nome do curso")) {
                const textNorm = texto.replace(/[\r\n]+/g, ' ');
                const regexNovoNome = /Lato Sensu em\s*(.*?)(?:Conforme|Modelo|SEI)/i;
                const matchNovoNome = textNorm.match(regexNovoNome);
                if(matchNovoNome) {
                    nomeCurso = matchNovoNome[1].trim();
                } else {
                    nomeCurso = "NOME INDEFINIDO";
                }
            }

            const regexCH = /Carga Hor√°ria Total:\s*([0-9]{2,4})\s*h/i;
            const matchCH = texto.match(regexCH);
            const cargaHorariaTotal = matchCH ? parseInt(matchCH[1]) : null;

            const regexVagas = /N√∫mero de Vagas\s*([0-9]{1,3})/i;
            const matchVagas = texto.match(regexVagas);
            const vagas = matchVagas ? parseInt(matchVagas[1]) : 0;
            
            const regexCoordenador = /Coordenador\(a\)\s+([A-Za-z\s]+)/i;
            const matchCoordenador = texto.match(regexCoordenador);
            const nomeCoordenador = matchCoordenador ? matchCoordenador[1].trim() : 'N√£o Encontrado';

            // NOVAS VARI√ÅVEIS PARA TITULA√á√ÉO
            let somaCargaDocente = 0;
            let qtdDocentes = 0;
            let chDoutor = 0;
            let chMestre = 0;
            let chEspec = 0;
            let naoDoutores = 0;
            let externos = 0;
            
            // Regex ajustado para capturar Titula√ß√£o e Carga Hor√°ria
            const regexLinhaDocente = /([\w\s√°√©√≠√≥√∫√£√µ√ß]+)\s+([A-Za-z\s√°√©√≠√≥√∫√£√µ√ß]+)\s+(Docente|Externo)[\t ]+(\d{1,3})/gi;
            let matchDocente;
            
            regexLinhaDocente.lastIndex = 0; 
            while ((matchDocente = regexLinhaDocente.exec(texto)) !== null) {
                const carga = parseInt(matchDocente[4]);
                somaCargaDocente += carga;
                qtdDocentes++;
                
                const titulacao = matchDocente[2].toLowerCase();
                const vinculo = matchDocente[3].toLowerCase();

                if (titulacao.includes('doutor') || titulacao.includes('dr')) {
                    chDoutor += carga;
                } else if (titulacao.includes('mestre') || titulacao.includes('me')) {
                    chMestre += carga;
                    naoDoutores++;
                } else if (titulacao.includes('especialista') || titulacao.includes('es')) {
                    chEspec += carga;
                    naoDoutores++;
                } else {
                    naoDoutores++;
                }

                if (vinculo.includes('externo')) {
                    externos++;
                }
            }


            let output = "";

            output += nomeCurso
                ? `üìò Nome do Curso: ${nomeCurso}\n`
                : `<span class="alert">‚ö†Ô∏è Nome do curso N√ÉO ENCONTRADO.</span>\n`;

            output += `üë§ Coordenador: ${nomeCoordenador}\n`;
            
            output += cargaHorariaTotal
                ? `‚è±Ô∏è Carga Hor√°ria Total: ${cargaHorariaTotal} horas\n`
                : `<span class="alert">‚ö†Ô∏è Carga hor√°ria N√ÉO ENCONTRADA.</span>\n`;

            output += `üë• N√∫mero de Vagas: ${vagas}\n`;
            output += `üë®‚Äçüè´ Docentes encontrados: ${qtdDocentes}\n`;
            output += `üìö Carga Hor√°ria Docente Total: ${somaCargaDocente} horas\n`;
            output += `   ‚Ä¢ Carga Hor√°ria Doutores: ${chDoutor} horas\n`;
            output += `   ‚Ä¢ Carga Hor√°ria Mestres: ${chMestre} horas\n`;
            output += `   ‚Ä¢ Carga Hor√°ria Especialistas: ${chEspec} horas\n`;


            if (cargaHorariaTotal !== null) {
                if (somaCargaDocente === cargaHorariaTotal) {
                    output += `‚úÖ CH dos docentes corresponde √† carga total do curso.\n`;
                } else if (somaCargaDocente > cargaHorariaTotal) {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes EXCEDE em ${somaCargaDocente - cargaHorariaTotal} horas.</span>\n`;
                } else {
                    output += `<span class="alert">‚ö†Ô∏è CH dos docentes est√° ABAIXO em ${cargaHorariaTotal - somaCargaDocente} horas.</span>\n`;
                }
            }

            resultado.innerHTML = output; 

            // ATUALIZA√á√ÉO DOS DADOS EXTRA√çDOS
            dadosExtraidos = {
                nomeCurso: nomeCurso || 'CURSO INDEFINIDO',
                cargaHorariaTotal: cargaHorariaTotal || 360, 
                vagas: vagas || 40, 
                cargaDocentes: somaCargaDocente,
                qtdDocentes: qtdDocentes,
                chDoutor: chDoutor, 
                chMestre: chMestre, 
                chEspec: chEspec 
            };

            calcularOrcamento();
        }

        // Fun√ß√£o para formatar moeda com padr√£o BR (R$ 1.000,00)
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }


        // Fun√ß√£o principal de c√°lculo or√ßament√°rio (USANDO ALUNOS PAGANTES)
        function calcularOrcamento() {
            // Inputs de Custos/Remunera√ß√£o
            const horaAulaDoutor = parseFloat(document.getElementById("horaAulaDoutor").value) || 0;
            const horaAulaMestre = parseFloat(document.getElementById("horaAulaMestre").value) || 0;
            const horaAulaEspec = parseFloat(document.getElementById("horaAulaEspec").value) || 0;
            const valOrientacaoHora = parseFloat(document.getElementById("valOrientacaoHora").value) || 0; 
            const coord = parseFloat(document.getElementById("coord").value) || 0;
            const vice = parseFloat(document.getElementById("vice").value) || 0;
            const apoio = parseFloat(document.getElementById("apoio").value) || 0;
            const tutor = parseFloat(document.getElementById("tutor").value) || 0;
            
            // Taxas e Custos Fixos (AGORA CONSTANTES FIXAS)
            const custoCertificadoBase = CUSTO_CERTIFICADO_BASE;
            const taxaRessarcimentoPercent = TAXA_RESSARCIMENTO_FIXA; 
            const taxaGestaoPercent = TAXA_GESTAO_FIXA; 

            // Inputs de Receita (o valor necess√°rio, digitado pelo usu√°rio)
            let mensalidadeNecessariaInput = parseFloat(document.getElementById("mensalidadeNecessaria").value) || 0;


            // Custos Adicionais (Insumos/Servi√ßos)
            let custosAdicionais = 0;
            const container = document.getElementById("custosAdicionaisContainer");
            const inputs = container.querySelectorAll('input[type="number"]'); 
            const listaCustosAdicionais = [];

            inputs.forEach(input => {
                const valor = parseFloat(input.value) || 0;
                listaCustosAdicionais.push({
                    nome: document.querySelector(`label[for="${input.id}"]`) ? document.querySelector(`label[for="${input.id}"]`).textContent.replace(' (R$):', '') : input.id,
                    valor: valor
                });
                if (input.id !== 'mensalidadeNecessaria') { 
                    custosAdicionais += valor;
                }
            });

            // Dados extra√≠dos
            const duracaoMeses = DURACAO_MESES;
            const vagasTotais = dadosExtraidos.vagas || 0;
            const chDoutor = dadosExtraidos.chDoutor || 0;
            const chMestre = dadosExtraidos.chMestre || 0;
            const chEspec = dadosExtraidos.chEspec || 0;

            // NOVO C√ÅLCULO DE ALUNOS PAGANTES
            const vagasServ = Math.ceil(vagasTotais * PERC_VAGAS_SERV);
            const vagasMinorias = VAGAS_MIN_TURMA; // Assumindo uma turma, 1 vaga reservada
            const alunosPagantes = Math.max(0, vagasTotais - vagasServ - vagasMinorias);
            
            // C√ÅLCULO CUSTO DOC√äNCIA POR TITULA√á√ÉO
            const custoDocenciaDoutor = chDoutor * horaAulaDoutor;
            const custoDocenciaMestre = chMestre * horaAulaMestre;
            const custoDocenciaEspec = chEspec * horaAulaEspec;
            const custoDocenciaTotal = custoDocenciaDoutor + custoDocenciaMestre + custoDocenciaEspec;
            
            // C√ÅLCULO CUSTO OPERACIONAL
            // O custo do certificado deve ser para TODAS as vagas, inclusive as reservadas
            const custoCertificados = vagasTotais * custoCertificadoBase; 
            const custoOrientacao = vagasTotais * HORAS_ORIENTACAO_TCC * valOrientacaoHora; // Orienta√ß√£o para todos
            const custoTutores = tutor * duracaoMeses;
            const custoEquipeTotal = (coord + vice + apoio) * duracaoMeses;
            
            const custoOperacional = custoCertificados + custoDocenciaTotal + custoEquipeTotal + custoTutores + custoOrientacao + custosAdicionais;
            
            
            // C√ÅLCULO DA RECEITA NECESS√ÅRIA (AGORA BASEADO EM alunosPagantes)
            const somaTaxas = taxaRessarcimentoPercent + taxaGestaoPercent; 

            if (alunosPagantes === 0) {
                document.getElementById("orcamento").innerHTML = `<p class="alert-teto">‚ö†Ô∏è Alerta: O n√∫mero de alunos pagantes √© zero (Vagas Totais: ${vagasTotais}). O c√°lculo da mensalidade m√≠nima n√£o pode ser realizado.</p>`;
                return;
            }

            if (somaTaxas >= 1) { 
                document.getElementById("orcamento").innerHTML = `<p class="alert-teto">‚ö†Ô∏è Alerta: A soma das taxas (Ressarcimento UFG + Gest√£o) atinge 100% ou mais. O projeto √© financeiramente invi√°vel com estes valores.</p>`;
                return;
            }
            
            // Receita Total Necess√°ria = Custo Operacional / (1 - Taxas)
            const receitaTotalNecessaria = custoOperacional / (1 - somaTaxas);
            // Mensalidade Necess√°ria = Receita Necess√°ria / Alunos Pagantes / Dura√ß√£o
            const mensalidadeNecessaria = (receitaTotalNecessaria / alunosPagantes) / duracaoMeses;

            
            // DEFINE A MENSALIDADE A SER USADA PARA O C√ÅLCULO FINAL DE SALDO
            let mensalidadeUsada = mensalidadeNecessariaInput;
            
            if (mensalidadeNecessariaInput == 0 || mensalidadeNecessariaInput < mensalidadeNecessaria) {
                 mensalidadeUsada = mensalidadeNecessaria;
            }


            // C√ÅLCULOS FINAIS COM BASE NA MENSALIDADE ESCOLHIDA/NECESS√ÅRIA
            const receitaTotal = mensalidadeUsada * alunosPagantes * duracaoMeses; // Receita baseada em pagantes
            const ressarcimento = receitaTotal * taxaRessarcimentoPercent;
            const taxaGestao = receitaTotal * taxaGestaoPercent;

            const custoTotal = custoOperacional + ressarcimento + taxaGestao;
            const saldo = receitaTotal - custoTotal;


            // Gera√ß√£o de HTML
            const avisoTeto = ''; 

            // --- GERA√á√ÉO DA LISTA DE CUSTOS ADICIONAIS ---
            let custosAdicionaisHTML = '';
            const custosNaoZero = listaCustosAdicionais.filter(item => item.valor > 0 && item.nome !== 'Mensalidade');

            if (custosNaoZero.length > 0) {
                custosAdicionaisHTML += `<div class="orcamento-section-title">Custos Adicionais (Insumos/Servi√ßos)</div>`;
                custosNaoZero.forEach(item => {
                    if (item.valor > 0) { 
                         custosAdicionaisHTML += `
                            <div class="orcamento-item">
                                <span>‚Ä¢ ${item.nome}:</span>
                                <strong>${formatarMoeda(item.valor)}</strong>
                            </div>
                        `;
                    }
                });
                
                custosAdicionaisHTML += `
                    <div class="orcamento-item" style="font-weight: bold; border-top: 1px solid var(--border-color);">
                        <span>Total Custos Adicionais:</span>
                        <strong>${formatarMoeda(custosAdicionais)}</strong>
                    </div>
                `;
            }
            
            // --- GERA√á√ÉO DA LISTA DE EQUIPE ---
            let equipeHTML = '';
            const equipe = [
                { id: 'coord', nome: 'Coordenador', valor: coord, total: coord * duracaoMeses },
                { id: 'vice', nome: 'Vice-Coordenador', valor: vice, total: vice * duracaoMeses },
                { id: 'apoio', nome: 'Apoio Administrativo', valor: apoio, total: apoio * duracaoMeses },
                { id: 'tutor', nome: 'Tutor', valor: tutor, total: tutor * duracaoMeses }
            ].filter(membro => membro.valor > 0);

            if (equipe.length > 0) {
                equipeHTML += `<div class="orcamento-section-title">Remunera√ß√£o Mensal da Equipe (Total Projeto)</div>`;
                equipe.forEach(membro => {
                    equipeHTML += `
                        <div class="orcamento-item">
                            <span>‚Ä¢ ${membro.nome}: ${formatarMoeda(membro.valor)}/m√™s</span>
                            <strong>${formatarMoeda(membro.total)}</strong>
                        </div>
                    `;
                });
            }


            // Determina a mensalidade exibida
            const mensalidadeExibida = mensalidadeUsada === mensalidadeNecessaria 
                ? formatarMoeda(mensalidadeNecessaria).replace('R$', '') + ' (M√≠nimo)'
                : formatarMoeda(mensalidadeUsada).replace('R$', '');

            // Informa√ß√µes sobre alunos pagantes
            const infoAlunos = `
                <div class="orcamento-item">
                    <span>üë• Total de Vagas Extra√≠das:</span>
                    <strong>${vagasTotais}</strong>
                </div>
                <div class="orcamento-item">
                    <span>‚Ä¢ Vagas N√£o Pagantes (Servidores ${Math.round(PERC_VAGAS_SERV*100)}% + Minorias):</span>
                    <strong>${vagasServ + vagasMinorias} (${vagasServ} Serv. + ${vagasMinorias} Min.)</strong>
                </div>
                <div class="orcamento-item" style="font-weight: bold; border-bottom: 2px solid var(--border-color);">
                    <span>Alunos Pagantes (Base para Receita):</span>
                    <strong>${alunosPagantes}</strong>
                </div>
            `;


            const orcamentoHTML = `
                <h3 class="orcamento-section-title">Proje√ß√£o Or√ßament√°ria: ${dadosExtraidos.nomeCurso || 'CURSO INDEFINIDO'} (${DURACAO_MESES} MESES)</h3>
                ${avisoTeto}
                
                <div class="orcamento-section-title">An√°lise de Vagas e Alunos Pagantes</div>
                ${infoAlunos}

                <div class="orcamento-section-title">Custos Vari√°veis e Operacionais (Remunera√ß√£o Docente)</div>
                ${chDoutor > 0 ? `<div class="orcamento-item">
                    <span>‚Ä¢ Doc√™ncia Doutor (${chDoutor}h x R$ ${horaAulaDoutor.toFixed(2)}):</span>
                    <strong>${formatarMoeda(custoDocenciaDoutor)}</strong>
                </div>` : ''}
                ${chMestre > 0 ? `<div class="orcamento-item">
                    <span>‚Ä¢ Doc√™ncia Mestre (${chMestre}h x R$ ${horaAulaMestre.toFixed(2)}):</span>
                    <strong>${formatarMoeda(custoDocenciaMestre)}</strong>
                </div>` : ''}
                ${chEspec > 0 ? `<div class="orcamento-item">
                    <span>‚Ä¢ Doc√™ncia Especialista (${chEspec}h x R$ ${horaAulaEspec.toFixed(2)}):</span>
                    <strong>${formatarMoeda(custoDocenciaEspec)}</strong>
                </div>` : ''}
                
                <div class="orcamento-item">
                    <span>‚Ä¢ Orienta√ß√£o TCC (Total, ${vagasTotais} alunos x ${HORAS_ORIENTACAO_TCC}h):</span>
                    <strong>${formatarMoeda(custoOrientacao)}</strong>
                </div>

                ${equipeHTML} 

                <div class="orcamento-section-title">Outros Custos Fixos e Vari√°veis</div>
                <div class="orcamento-item">
                    <span>‚Ä¢ Custo Certificados (R$ ${custoCertificadoBase.toFixed(2)} x ${vagasTotais} alunos):</span>
                    <strong>${formatarMoeda(custoCertificados)}</strong>
                </div>
                
                ${custosAdicionaisHTML} 
                
                <div class="orcamento-item" style="font-weight: bold; padding-top: 15px; border-top: 2px solid var(--primary-color);">
                    <span>Total Custo Operacional (sem taxas):</span>
                    <strong>${formatarMoeda(custoOperacional)}</strong>
                </div>

                
                <div class="orcamento-section-title">Custos Legais (Baseados na Receita Total)</div>
                <div class="orcamento-item">
                    <span>‚Ä¢ Ressarcimento UFG (${(taxaRessarcimentoPercent * 100).toFixed(0)}%):</span>
                    <strong>${formatarMoeda(ressarcimento)}</strong>
                </div>
                <div class="orcamento-item">
                    <span>‚Ä¢ Taxa de Gest√£o da Funda√ß√£o (${(taxaGestaoPercent * 100).toFixed(0)}%):</span>
                    <strong>${formatarMoeda(taxaGestao)}</strong>
                </div>

                <div class="orcamento-section-title">Resultado Financeiro</div>
                <div class="orcamento-item">
                    <span>üí∞ Mensalidade Necess√°ria/Utilizada (R$/m√™s):</span>
                    <strong>R$ ${mensalidadeExibida}</strong>
                </div>
                <div class="orcamento-item">
                    <span>üíµ Receita Bruta Total:</span>
                    <strong>${formatarMoeda(receitaTotal)}</strong>
                </div>


                <div class="saldo-final ${saldo >= 0 ? 'lucro' : 'deficit'}">
                    <span>Total Geral de Custos: ${formatarMoeda(custoTotal)}</span>
                    <span>Saldo Final Estimado: <span class="valor">${formatarMoeda(saldo)}</span></span>
                </div>
                
            `;

            document.getElementById("orcamento").innerHTML = orcamentoHTML;
        }

        // Inicializa a an√°lise ao carregar (se houver dados)
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('texto').value = `
MINIST√âRIO DA EDUCA√á√ÉO
UNIVERSIDADE FEDERAL DE GOI√ÅS

PROJETO DE ENSINO
Oferta de Turma(s) de Curso de P√≥s-Gradua√ß√£o Lato Sensu em GEST√ÉO E INOVA√á√ÉO EM SA√öDE
(Conforme Resolu√ß√£o CEPEC N¬∫ 1952/2025 e Instru√ß√£o Normativa PRPG/UFG)

1. DADOS GERAIS
Tipo de Curso: 	Curso de Especializa√ß√£o, Resid√™ncia Profissional ou Treinamento Avan√ßado (Fellow)
Carga Hor√°ria Total: 420 h
N√∫mero de Vagas 50
Financiamento Mensalidade (modelo autofinanciado)

2. COORDENA√á√ÉO
	Nome	E-mail	Telefone
Coordenador(a)	Vitor Salgado	vitor_salgado@ufg.br	3521-2780
Vice-coordenador(a)	Edimar Dantas	edimar@ufg.br	3521-1837

7. CORPO DOCENTE
	Nome	Titula√ß√£o	V√≠nculo Institucional	Carga Hor√°ria
	Maria augusta	doutorado	Docente	90
	Roberta miranda	doutorado	Docente	90
	Dias anas	mestre	Docente	90
	Paula marcos	especialista	Docente	90
`;
            analisar();
            checkTetoIndividual('horaAulaDoutor');
            checkTetoIndividual('horaAulaMestre');
            checkTetoIndividual('horaAulaEspec');
            checkTetoIndividual('valOrientacaoHora');
        });
    </script>
</body>
</html>
